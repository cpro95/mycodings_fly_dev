# Fly.io의 내부 포트(8080)
:8080

# Hugo가 빌드한 정적 파일 위치
root * /srv

# 정적 파일 서버
file_server

# 압축 활성화 (gzip, zstd 모두 사용)
encode gzip zstd

# 브라우저 캐시 정책 (1년 유지, 변경 불가로 표시)
@static {
    path *.css *.js *.woff2 *.woff *.ttf *.svg *.png *.jpg *.jpeg *.gif *.ico *.webp *.avif *.pdf *.json
}
header @static Cache-Control "public, max-age=31536000, immutable"

# HTML과 XML은 짧게 캐시 (변경 가능성 있으므로)
@html {
    path *.html *.xml
}
header @html Cache-Control "public, max-age=86400, stale-while-revalidate=604800"

# 기타 MIME 타입 (기본 1일 캐시)
header Cache-Control "public, max-age=86400"

# ETag 지원 (변경 시 자동 304 반환)
etag

# 기본 보안 헤더 추가
header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "strict-origin-when-cross-origin"
    Content-Security-Policy "default-src 'self'; img-src 'self' data:;"
}
