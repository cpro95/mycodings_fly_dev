---
slug: 2024-12-25-react-router-with-cloudflare-pages-d-1-db
title: React Router V7ê³¼ Cloudflare Pages ê·¸ë¦¬ê³  D1 Database ì‚¬ìš©
date: 2024-12-25T06:47:59.815Z
description: React Router V7ë¥¼ Cloudflare Pagesì— D1 DBë¥¼ ì´ìš©í•´ì„œ ë°°í¬í•  ìˆ˜ ìˆê²Œ ê°œì¡°í•˜ê¸°
meta:
  keywords:
    - react
    - react router v7
    - react router
    - cloudflare
    - d1 db
    - cloudflare pages
published: true
---

# React Router V7ê³¼ Cloudflare Pages ê·¸ë¦¬ê³  D1 Database ì‚¬ìš©

** ëª©ì°¨ **

- [React Router V7ê³¼ Cloudflare Pages ê·¸ë¦¬ê³  D1 Database ì‚¬ìš©](#react-router-v7ê³¼-cloudflare-pages-ê·¸ë¦¬ê³ -d1-database-ì‚¬ìš©)
  - [React Router V7ì— Cloudflare ê´€ë ¨ ì¶”ê°€í•˜ê¸°](#react-router-v7ì—-cloudflare-ê´€ë ¨-ì¶”ê°€í•˜ê¸°)
  - [wranglerë¡œ Cloudflare ê´€ë ¨ ì„¸íŒ…í•˜ê¸°](#wranglerë¡œ-cloudflare-ê´€ë ¨-ì„¸íŒ…í•˜ê¸°)
  - [tsconfig.json íŒŒì¼ì— types ì •ë³´ ì¶”ê°€í•˜ê¸°](#tsconfigjson-íŒŒì¼ì—-types-ì •ë³´-ì¶”ê°€í•˜ê¸°)
  - [entry.server.tsx íŒŒì¼ ì†ë³´ê¸°](#entryservertsx-íŒŒì¼-ì†ë³´ê¸°)
  - [vite.config íŒŒì¼ ì†ë³´ê¸°](#viteconfig-íŒŒì¼-ì†ë³´ê¸°)
  - [D1 DB ì¶”ê°€](#d1-db-ì¶”ê°€)
  - [D1 DB ì½”ë“œ í…ŒìŠ¤íŠ¸í•˜ê¸°](#d1-db-ì½”ë“œ-í…ŒìŠ¤íŠ¸í•˜ê¸°)
  - [Cloudflare ê´€ë ¨ íƒ€ì… ì •ë³´ ì¶”ê°€í•˜ê¸°](#cloudflare-ê´€ë ¨-íƒ€ì…-ì •ë³´-ì¶”ê°€í•˜ê¸°)
  - [package.json íŒŒì¼ scripts ì†ë³´ê¸°](#packagejson-íŒŒì¼-scripts-ì†ë³´ê¸°)


ì•ˆë…•í•˜ì„¸ìš”?

ì§€ë‚œ ì‹œê°„ì— React Router V7ì„ ì´ìš©í•œ ê°€ì¥ ê¸°ë³¸ì ì¸ ìœ ì € ë¡œê·¸ì¸ êµ¬í˜„ì„ ì•Œì•„ë³´ì•˜ëŠ”ë°ìš”.

[React Router V7 ìœ ì € Auth(ë¡œê·¸ì¸) êµ¬í˜„í•˜ê¸°](https://mycodings.fly.dev/blog/2024-12-25-tutorial-react-router-v-7-user-auth)

ì´ë²ˆ ì‹œê°„ì—ëŠ” Cloudflare ë„¤íŠ¸ì›Œí¬ìƒì— ë°°í¬í•  ìˆ˜ ìˆëŠ” Pages ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆê²Œ React Router í…œí”Œë¦¿ì„ ê°œì¡°í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ë¨¼ì €, create-react-routerë¥¼ ì´ìš©í•´ì„œ ë¹ˆ í…œí”Œë¦¿ì„ ì•„ë˜ì™€ ê°™ì´ ë§Œë“­ë‹ˆë‹¤.

```sh
npx create-react-router@latest 

or

pnpx create-react-router@latest 
```

ë§¥ë¶ ìš©ëŸ‰ì´ ë§ìœ¼ë©´ NPMì´ë‚˜ NPX ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì…”ë„ ë¬´ë°©í•˜ì§€ë§Œ ì € ê°™ì´ 256GB ë§¥ë¶ì„ ê°€ì§€ê³  ê³„ì‹ ë¶„ì´ë¼ë©´ ë˜ë„ë¡ì´ë©´ PNPMì´ë‚˜ PNPXë¥¼ ì‚¬ìš©í•˜ëŠ” ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.

í•˜ë“œ ìš©ëŸ‰ ì ˆì•½ì´ ëˆˆì— ë„ê²Œ í¬ë‹¤ëŠ” ê±¸ ì‰½ê²Œ ì²´ê°í•  ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

ì¼ë‹¨ ì•„ë˜ì™€ ê°™ì´ ê°€ì¥ ê¸°ë³¸ì ì¸ React Router V7 í…œí”Œë¦¿ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```sh
react-router-cloudflare-pages-d1-test

         create-react-router v7.1.1
      â—¼  Directory: Using react-router-cloudflare-pages-d1-test as project directory

      â—¼  Using default template See https://github.com/remix-run/react-router-templates for more
      âœ”  Template copied

   git   Initialize a new git repository?
         Yes

  deps   Install dependencies with pnpm?
         Yes

      âœ”  Dependencies installed

      âœ”  Git initialized

  done   That's it!

         Enter your project directory using cd ./react-router-cloudflare-pages-d1-test
         Check out README.md for development and deploy instructions.

         Join the community at https://rmx.as/discord
```

ì´ì œ, í„°ë¯¸ë„ì˜ tree ëª…ë ¹ì–´ë¥¼ í†µí•´ ì „ì²´ì ì¸ êµ¬ì¡°ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.

```sh
âœ  react-router-cloudflare-pages-d1-test git:(main) âœ— tree . -L 2
.
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Dockerfile.bun
â”œâ”€â”€ Dockerfile.pnpm
â”œâ”€â”€ README.md
â”œâ”€â”€ app
â”‚Â Â  â”œâ”€â”€ app.css
â”‚Â Â  â”œâ”€â”€ root.tsx
â”‚Â Â  â”œâ”€â”€ routes
â”‚Â Â  â”œâ”€â”€ routes.ts
â”‚Â Â  â””â”€â”€ welcome
â”œâ”€â”€ node_modules
â”‚Â Â  â”œâ”€â”€ @react-router
â”‚Â Â  â”œâ”€â”€ @types
â”‚Â Â  â”œâ”€â”€ autoprefixer -> .pnpm/autoprefixer@10.4.20_postcss@8.4.49/node_modules/autoprefixer
â”‚Â Â  â”œâ”€â”€ cross-env -> .pnpm/cross-env@7.0.3/node_modules/cross-env
â”‚Â Â  â”œâ”€â”€ isbot -> .pnpm/isbot@5.1.18/node_modules/isbot
â”‚Â Â  â”œâ”€â”€ postcss -> .pnpm/postcss@8.4.49/node_modules/postcss
â”‚Â Â  â”œâ”€â”€ prettier -> .pnpm/prettier@2.8.8/node_modules/prettier
â”‚Â Â  â”œâ”€â”€ react -> .pnpm/react@19.0.0/node_modules/react
â”‚Â Â  â”œâ”€â”€ react-dom -> .pnpm/react-dom@19.0.0_react@19.0.0/node_modules/react-dom
â”‚Â Â  â”œâ”€â”€ react-router -> .pnpm/react-router@7.1.1_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/react-router
â”‚Â Â  â”œâ”€â”€ tailwindcss -> .pnpm/tailwindcss@3.4.17/node_modules/tailwindcss
â”‚Â Â  â”œâ”€â”€ typescript -> .pnpm/typescript@5.7.2/node_modules/typescript
â”‚Â Â  â”œâ”€â”€ vite -> .pnpm/vite@5.4.11_@types+node@20.17.10/node_modules/vite
â”‚Â Â  â””â”€â”€ vite-tsconfig-paths -> .pnpm/vite-tsconfig-paths@5.1.4_typescript@5.7.2_vite@5.4.11_@types+node@20.17.10_/node_modules/vite-tsconfig-paths
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ public
â”‚Â Â  â””â”€â”€ favicon.ico
â”œâ”€â”€ react-router.config.ts
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts

20 directories, 15 files
```

ìœ„ êµ¬ì¡°ë¥¼ ë³´ë©´ ì•„ì£¼ ê¹”ë”í•œ node_modules êµ¬ì¡°ê°€ ë³´ì¼ê²ë‹ˆë‹¤.

PNPMì˜ ìœ„ë ¥ì´ì£ .

---

## React Router V7ì— Cloudflare ê´€ë ¨ ì¶”ê°€í•˜ê¸°

ì´ì œ Cloudflare ê´€ë ¨ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ 3ê°€ì§€ê°€ í•„ìš”í•œë°ìš”.

ë¨¼ì €, @react-router/cloudflareì™€ wrangler íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

```sh
npm install @react-router/cloudflare wrangler

or

pnpm install @react-router/cloudflare wrangler
```

ë§ˆì§€ë§‰ìœ¼ë¡œ í•„ìš”í•œê²Œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ ê°œë°œí•˜ê¸° ìœ„í•œ íƒ€ì…ì •ë³´ì¸ë°ìš”.

```sh
npm install -D @cloudflare/workers-types

or

pnpm install -D @cloudflare/workers-types
```

ì§€ê¸ˆê¹Œì§€ì˜ package.json íŒŒì¼ì„ ë³´ê² ìŠµë‹ˆë‹¤.

```sh
âœ  react-router-cloudflare-pages-d1-test git:(main) âœ— bat package.json
â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚ File: package.json
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1   â”‚ {
   2   â”‚   "name": "react-router-cloudflare-pages-d1-test",
   3   â”‚   "private": true,
   4   â”‚   "type": "module",
   5   â”‚   "scripts": {
   6   â”‚     "build": "cross-env NODE_ENV=production react-router build",
   7   â”‚     "dev": "react-router dev",
   8   â”‚     "start": "cross-env NODE_ENV=production react-router-serve ./build/server/index.js",
   9   â”‚     "typecheck": "react-router typegen && tsc"
  10   â”‚   },
  11   â”‚   "dependencies": {
  12 + â”‚     "@react-router/cloudflare": "^7.1.1",
  13   â”‚     "@react-router/node": "^7.1.1",
  14   â”‚     "@react-router/serve": "^7.1.1",
  15   â”‚     "isbot": "^5.1.17",
  16   â”‚     "react": "^19.0.0",
  17   â”‚     "react-dom": "^19.0.0",
  18 ~ â”‚     "react-router": "^7.1.1",
  19 ~ â”‚     "wrangler": "^3.99.0"
  20   â”‚   },
  21   â”‚   "devDependencies": {
  22 + â”‚     "@cloudflare/workers-types": "^4.20241224.0",
  23   â”‚     "@react-router/dev": "^7.1.1",
  24   â”‚     "@types/node": "^20",
  25   â”‚     "@types/react": "^19.0.1",
  26   â”‚     "@types/react-dom": "^19.0.1",
  27   â”‚     "autoprefixer": "^10.4.20",
  28   â”‚     "cross-env": "^7.0.3",
  29   â”‚     "postcss": "^8.4.49",
  30   â”‚     "tailwindcss": "^3.4.16",
  31   â”‚     "typescript": "^5.7.2",
  32   â”‚     "vite": "^5.4.11",
  33   â”‚     "vite-tsconfig-paths": "^5.1.4"
  34   â”‚   }
  35   â”‚ }
â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

cat ëª…ë ¹ì–´ ë§ê³  bat ëª…ë ¹ì–´ê°€ í„°ë¯¸ë„ ìƒì—ì„œ ì•„ì£¼ ê¹”ë”í•˜ê²Œ í…ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì£¼ë„¤ìš”.

`brew install bat` ëª…ë ¹ì–´ë¡œ ì‰½ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## wranglerë¡œ Cloudflare ê´€ë ¨ ì„¸íŒ…í•˜ê¸°

wrangler.toml íŒŒì¼ì´ Cloudflare ê´€ë ¨ ê°€ì¥ ê¸°ë³¸ì ì¸ íŒŒì¼ì¸ë°ìš”.

ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

```sh
name = "react-router-cloudflare-pages-d1-test"
compatibility_date = "2024-11-12"
pages_build_output_dir = "./build/client"
```

ì—¬ê¸°ì„œ ì¤‘ìš”í•œê²Œ Cloudflare Worker ë°©ì‹ì´ ì•„ë‹Œ Pagesë¥¼ ì´ìš©í•´ì„œ í™ˆí˜ì´ì§€ë¥¼ ì›¹ìƒì— ë°°í¬í•˜ê³  ì‹¶ì„ë•ŒëŠ” ìœ„ì™€ ê°™ì´ `pages_build_output_dir` ì˜µì…˜ì´ ê¼­ ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.

ì´ ì˜µì…˜ì´ ì—†ìœ¼ë©´ Wranglerê°€ Worker ì˜µì…˜ìœ¼ë¡œ ì¸ì‹í•˜ê³  workerë¡œ ë°°í¬í•˜ê²Œ ë©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ `pages_build_output_dir` ì˜µì…˜ì— ë“¤ì–´ê°„ ê°’ì´ ë­˜ê¹Œìš”?

ë°”ë¡œ React Router V7 ì•±ì„ ë¹Œë“œ(build)í•˜ë©´ ìƒê¸°ëŠ” í´ë”ì¸ë°ìš”.

í•œë²ˆ ë¹Œë“œí•´ ë³´ê² ìŠµë‹ˆë‹¤.

```sh
âœ  test-cf git:(main) âœ— pnpm run build

> test-cf@ build /Users/cpro95/Codings/Javascript/react-router-test/test-cf
> cross-env NODE_ENV=production react-router build

vite v5.4.11 building for production...
âœ“ 45 modules transformed.
build/client/.vite/manifest.json                  1.37 kB â”‚ gzip:  0.37 kB
build/client/assets/app-Ckulty-W.css              7.33 kB â”‚ gzip:  2.13 kB
build/client/assets/with-props-BJdOiEPt.js        0.35 kB â”‚ gzip:  0.21 kB
build/client/assets/home-D555HUO7.js              0.50 kB â”‚ gzip:  0.35 kB
build/client/assets/root-CzEkcZd-.js              1.19 kB â”‚ gzip:  0.67 kB
build/client/assets/chunk-K6AXKMTT-DycbfBQN.js  105.32 kB â”‚ gzip: 35.59 kB
build/client/assets/entry.client-u-M4TmH-.js    178.81 kB â”‚ gzip: 56.77 kB
âœ“ built in 680ms
vite v5.4.11 building SSR bundle for production...
âœ“ 8 modules transformed.
build/server/.vite/manifest.json      0.43 kB
build/server/assets/app-Ckulty-W.css  7.33 kB
build/server/index.js                 6.28 kB
âœ“ built in 38ms
```

ìœ„ì™€ ê°™ì´ buildê°€ ì„±ê³µí•˜ë©´ ì•„ë˜ì™€ ê°™ì´ build í´ë”ê°€ ìƒê¹ë‹ˆë‹¤.

```sh
âœ  test-cf git:(main) âœ— tree ./build -L 2
./build
â”œâ”€â”€ client
â”‚Â Â  â”œâ”€â”€ assets
â”‚Â Â  â””â”€â”€ favicon.ico
â””â”€â”€ server
    â”œâ”€â”€ assets
    â””â”€â”€ index.js

5 directories, 2 files
```

ì˜ ë³´ì‹œë©´ server í´ë” ë°‘ì— ìˆëŠ” index.jsê°€ ë°”ë¡œ ì›¹ ì„œë²„ë¥¼ êµ¬ë™í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.

ë§Œì•½ NodeJSë¥¼ ì´ìš©í•´ì„œ VPSì— ë°°í¬í•˜ë©´ node ì„œë²„ê°€ ë˜ëŠ” ê±°ê³ , Cloudflareì— ë°°í¬í•˜ë©´ Cloudflare workerë¥¼ ì´ìš©í•´ì„œ ì„œë²„ê°€ ëŒì•„ê°€ê²Œ ë˜ëŠ” ê²ë‹ˆë‹¤.

ìš°ë¦¬ì˜ ëª©ì ì€ Cloudflare ìƒì— Pages ì„œë¹„ìŠ¤ í˜•íƒœë¡œ ë°°í¬í•˜ê¸° ì›í•˜ê¸° ë•Œë¬¸ì— ì´ ì—­í• ì„ í•  Cloudflare ë§Œì˜ íŠ¹ë³„í•œ íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ë§Œì•½ workerë¥¼ ì´ìš©í•´ì„œ ë°°í¬í•œë‹¤ë©´ workers í´ë”ì˜ app.ts íŒŒì¼ì´ í•„ìš”í•˜ê³ , Pages ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ë°°í¬í•œë‹¤ë©´ functions í´ë” ë°‘ì˜ `[[path]].ts` íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” Pages ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— functions í´ë” ë°‘ì— `[[path]].ts` íŒŒì¼ì„ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

```ts
import { createPagesFunctionHandler } from "@react-router/cloudflare";
import * as build from "../build/server";
import type { ServerBuild } from "react-router";

export const onRequest = createPagesFunctionHandler({
  build: build as ServerBuild,
});
```

ìœ„ íŒŒì¼ì´ Cloudflare ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ì‹¤í–‰ë˜ëŠ” worker í•¨ìˆ˜ì¸ë°ìš”.

onRequest ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì£¼ë©´ ëª¨ë“  ì›¹ ë¦¬í€˜ìŠ¤íŠ¸ì¼ ë•Œ ì‹¤í–‰í•œë‹¤ëŠ” ëœ»ìœ¼ë¡œ ì¦‰, ì„œë²„ê°€ ì‹¤í–‰ëœë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

ì´ë•Œ ìœ„ì—ì„œ createPagesFunctionHandler ë¼ëŠ” cloudflare ë§Œì˜ react-routerê°€ ì œê³µí•˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì´ìš©í•´ì„œ ìš°ë¦¬ê°€ ì•„ê¹Œ buildí•œ í´ë”ì˜ `server/index.js`ë¥¼ ëŒë¦¬ê²Œ ë˜ëŠ” ê²ë‹ˆë‹¤.

ì´ íŒŒì¼ì„ ë§Œë“¤ë©´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë¶ˆë§Œì„ í‘œì‹œí•˜ëŠ”ë°ìš”.

ë¬´ì‹œí•˜ì‹œë©´ ë©ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEh6T_lipSqBVUEqI1FRpHRWs31ZXtGeXDRalbx7TnQ96WL5OJzOTJlXZN77ZEEYQgA-x0u2IYZVIzJXQ9eKBhfyf7c5t51xQ41VSJOqKXpeVfoTYCX_cRu8x44EafUa4h0XfEQRbG2XwsBkew4OxEOCe54ucpr02udn4aCuHV7MDMB214bfebtoMzHWAco)

---

## tsconfig.json íŒŒì¼ì— types ì •ë³´ ì¶”ê°€í•˜ê¸°

Cloudflare worker ê´€ë ¨ íƒ€ì…ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ tsconfig.json íŒŒì¼ì„ ì—½ë‹ˆë‹¤.

compilerOptions ë°‘ì— ìˆëŠ” types í•­ëª©ì„ ì•„ë˜ì™€ ê°™ì´ ë§Œë“­ë‹ˆë‹¤.

`@cloudflare/workers-types`ë§Œ ì¶”ê°€í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

```ts
"compilerOptions": {
   ...
   "types": ["@cloudflare/workers-types", "node", "vite/client"],
   ...
}
```

---

## entry.server.tsx íŒŒì¼ ì†ë³´ê¸°

Remix í”„ë ˆì„ì›ì„ ë‹¤ë£¨ë‹¤ ë³´ë©´ entry.server.tsx íŒŒì¼ê³¼ entry.client.tsx íŒŒì¼ì´ ë³´ì´ëŠ”ë°ìš”.

React Routerì—ì„œëŠ” ë³´ì´ì§€ê°€ ì•ŠìŠµë‹ˆë‹¤.

ìˆ¨ê²¨ë†“ì€ ê±´ë°ìš”.

ê·¸ëƒ¥ Node ì„œë²„ë¥¼ ì´ìš©í•  ê±°ë¼ë©´ ê³ ì¹  í•„ìš”ê°€ ì—†ì§€ë§Œ ìš°ë¦¬ëŠ” Nodeê°€ ì•„ë‹ˆë¼ Cloudflare worker ëŸ°íƒ€ì„ì„ ì´ìš©í•  ê±°ë¼ì„œ entry.serverë¥¼ ì§ì ‘ ê³ ì³ì•¼ í•©ë‹ˆë‹¤.

ì¼ë‹¨ ìˆ¨ê²¨ë†“ì€ ë‘ ê°œì˜ íŒŒì¼ì„ íŒŒì¼ì— ë³´ì´ê²Œ í•´ì•¼ í•˜ëŠ”ë°ìš”.

ì•„ë˜ì™€ ê°™ì´ í„°ë¯¸ë„ ìƒì—ì„œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.

```sh
âœ  react-router-cloudflare-pages-d1-test git:(main) âœ— npx react-router reveal
Entry file entry.client created at app/entry.client.tsx.
Entry file entry.server created at app/entry.server.tsx.
```

`npx react-router reveal` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ìœ„ì™€ ê°™ì´ ë‘ ê°œì˜ íŒŒì¼ì´ reveal ë˜ì–´ ì§‘ë‹ˆë‹¤.

entry.client íŒŒì¼ì€ ê±´ë“¤ê²Œ ì—†ì–´ ê·¸ëŒ€ë¡œ ë‚˜ë‘ê³  entry.server íŒŒì¼ë§Œ ì•„ë˜ì™€ ê°™ì´ ê³ ì¹©ë‹ˆë‹¤.

Remix í…œí”Œë¦¿ì—ì„œ ê°€ì ¸ì˜¨ ê²ë‹ˆë‹¤.

ì°¨ì´ì ì€ NodeJSë¥¼ ì´ìš©í•˜ë©´ react-dom ì„œë²„ì˜ renderToPipeableStream í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì§€ë§Œ Cloudflare worker ëŸ°íƒ€ì„ì„ ì‚¬ìš©í•  ê²½ìš° renderToReadableStream í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

entry.server.tsx íŒŒì¼ì˜ ì „ì²´ ë‚´ìš©ì„ ì•„ë˜ì™€ ê°™ì´ ë°”ê¿‰ë‹ˆë‹¤.

```ts
import type { AppLoadContext, EntryContext } from "react-router";
import { ServerRouter } from "react-router";
import { isbot } from "isbot";
import { renderToReadableStream } from "react-dom/server";

export default async function handleRequest(
  request: Request,
  responseStatusCode: number,
  responseHeaders: Headers,
  routerContext: EntryContext,
  _loadContext: AppLoadContext
) {
  let shellRendered = false;
  const userAgent = request.headers.get("user-agent");

  const body = await renderToReadableStream(
    <ServerRouter context={routerContext} url={request.url} />,
    {
      onError(error: unknown) {
        responseStatusCode = 500;
        // Log streaming rendering errors from inside the shell.  Don't log
        // errors encountered during initial shell rendering since they'll
        // reject and get logged in handleDocumentRequest.
        if (shellRendered) {
          console.error(error);
        }
      },
    }
  );
  shellRendered = true;

  // Ensure requests from bots and SPA Mode renders wait for all content to load before responding
  // https://react.dev/reference/react-dom/server/renderToPipeableStream#waiting-for-all-content-to-load-for-crawlers-and-static-generation
  if ((userAgent && isbot(userAgent)) || routerContext.isSpaMode) {
    await body.allReady;
  }

  responseHeaders.set("Content-Type", "text/html");
  return new Response(body, {
    headers: responseHeaders,
    status: responseStatusCode,
  });
}
```

ê·¸ëƒ¥ ì´ë ‡ê²Œë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ê²Œ React Routerê°€ ì„œë²„ë¥¼ ëŒë¦´ ë•Œ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ê°€ ë˜ëŠ” ê²ë‹ˆë‹¤.

---

## vite.config íŒŒì¼ ì†ë³´ê¸°

ìœ„ì™€ ê°™ì´ entry.server.tsx íŒŒì¼ì„ ì†ë´¤ìœ¼ë©´ Vite ê°œë°œ ì„œë²„ë¥¼ ìœ„í•´ì„œ `vite.config.ts` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì†ë´ì•¼ í•©ë‹ˆë‹¤.

```ts
import { cloudflareDevProxy } from "@react-router/dev/vite/cloudflare";

export default defineConfig({
  css: {
    postcss: {
      plugins: [tailwindcss, autoprefixer],
    },
  },
  plugins: [cloudflareDevProxy(), reactRouter(), tsconfigPaths()],
});
```

ìœ„ ì½”ë“œë¥¼ ë³´ì‹œë©´ cloudflareDevProxy ë§Œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ì œ Cloudflare ìƒì—ì„œ Pages ì„œë¹„ìŠ¤ í˜•íƒœë¡œ ë°°í¬í•  ìˆ˜ ìˆê²Œ ì™„ë£Œê°€ ë˜ì—ˆëŠ”ë°ìš”.

ì—¬ê¸°ì„œ ê·¸ì¹˜ì§€ ë§ê³  D1 DBë¥¼ ì´ìš©í•  ìˆ˜ ìˆê²Œ ì—¬ëŸ¬ ê°€ì§€ ì„¤ì •ì„ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

---

## D1 DB ì¶”ê°€

ì¼ë‹¨ wrangler ëª…ë ¹ì–´ë¡œ D1 DBë¥¼ í•˜ë‚˜ ë§Œë“­ë‹ˆë‹¤.

```sh
âœ  react-router-cloudflare-pages-d1-test git:(main) âœ— pnpx wrangler d1 create mydb

 â›…ï¸ wrangler 3.99.0
-------------------

âœ… Successfully created DB 'mydb' in region WNAM
Created your new D1 database.

[[d1_databases]]
binding = "DB"
database_name = "mydb"
database_id = "5~~~~~~~~~~~~~~~~~~~~a"
```

ìœ„ì™€ ê°™ì´ 'mydb'ë¼ëŠ” ì´ë¦„ì˜ D1 DBë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

Cloudflare ì›¹ìœ¼ë¡œ ë“¤ì–´ê°€ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ìƒì„±ëœê²Œ ë³´ì¼ê²ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEjsCcjlXiRGFuQBPzeNgwYjbDLL5g5JGpzKMgTiOBNwXhcGVWk4dsMVxynICIgYR5ghQv7aYQBaV9KIR-R7yv4NC2DmgLabo_scWBqsKWJoNjO0m7BK8bww1eVcW-sjmsg7aMi9HWBaiBhJVP7oo6OuUiMhzeRccs5ptBAosXlgtzATGCH0odCqemQm1ag)

ì´ì œ d1_databases ë¶€ë¶„ì„ wrangler.toml íŒŒì¼ì— ë¶™ì—¬ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.

```toml
name = "react-router-cloudflare-pages-d1-test"
compatibility_date = "2024-11-12"
pages_build_output_dir = "./build/client"

[[d1_databases]]
binding = "DB"
database_name = "mydb"
database_id = "5~~~~~~~~~~~~~~~~~~~~a"
```

ì´ì œ D1 DBë¥¼ ìƒì„±í–ˆìœ¼ë‹ˆ Tableì„ ë§Œë“¤ì–´ì•¼ê² ì£ .

ìµœìƒìœ„ í´ë”ì—ì„œ db í´ë”ë¥¼ ë§Œë“¤ê³  schema.sql íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ë§Œë“­ë‹ˆë‹¤.

```sql
CREATE TABLE `todos` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` text,
	`isCompleted` integer DEFAULT false NOT NULL
);
```

ì•„ì£¼ ê°„ë‹¨í•œ todos í…Œì´ë¸”ì…ë‹ˆë‹¤.

ì´ì œ ì´ SQL í…Œì´ë¸”ì„ ì´ìš©í•´ì„œ ì‹¤ì œë¡œ D1 DBì— í…Œì´ë¸”ì„ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ë°ìš”.

ì•„ë˜ì™€ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ í•©ë‹ˆë‹¤.

```sh
âœ pnpx wrangler d1 execute mydb --local --file=./db/schema.sql

 â›…ï¸ wrangler 3.99.0
-------------------

ğŸŒ€ Executing on local database mydb (59~~~~~~~~~~~~~~~~~~~~~~7a) from .wrangler/state/v3/d1:
ğŸŒ€ To execute on your remote database, add a --remote flag to your wrangler command.
ğŸš£ 1 command executed successfully.
```

ìœ„ì™€ ê°™ì´ '--local' ì˜µì…˜ì„ ì£¼ë©´ ë¡œì»¬ ê°œë°œì„œë²„ì˜ D1 DBì— ì ìš©ë˜ëŠ” ê²ë‹ˆë‹¤.

'--remote' ì˜µì…˜ìœ¼ë¡œ ì‹¤ì œ Cloudflare ì„œë²„ì— ì ìš©í•´ ë³¼ê¹Œìš”?

```sh
âœ— pnpx wrangler d1 execute mydb --remote --file=./db/schema.sql

 â›…ï¸ wrangler 3.99.0
-------------------

âœ” âš ï¸ This process may take some time, during which your D1 database will be unavailable to serve queries.
  Ok to proceed? â€¦ yes
ğŸŒ€ Executing on remote database mydb (5~~~~~~~~~~~~~~~~~~~~~~7a):
ğŸŒ€ To execute on your local development database, remove the --remote flag from your wrangler command.
Note: if the execution fails to complete, your DB will return to its original state and you can safely retry.
â”œ ğŸŒ€ Uploading 5~~~~~~~~~~~~~~~a7a.4863d22c297eaea3.sql
â”‚ ğŸŒ€ Uploading complete.
â”‚
ğŸŒ€ Starting import...
ğŸŒ€ Processed 1 queries.
ğŸš£ Executed 1 queries in 0.00 seconds (2 rows read, 4 rows written)
   Database is currently at bookmark 00000001-00000005-00004e72-c5040d254dc6ccd3b20d4a735370929b.
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Total queries executed â”‚ Rows read â”‚ Rows written â”‚ Database size (MB) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1                      â”‚ 2         â”‚ 4            â”‚ 0.02               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ì—”í„°í‚¤ë¥¼ í•œë²ˆ ì¹˜ë©´ ìˆ˜í–‰ë˜ëŠ”ë°ìš”.

ì‹¤ì œ Cloudflare ì›¹ìƒì—ì„œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEgEPG0kX-SgljRJ1JuCh4BLUn_chCl74BfAFl5Vtq1sEmaOFAjUc1XBLOkHtDKkJzykpXmRwsuwhLO0ClXMwIUsg2xEdm6MM9O1UqsvKyF15IK8rD1GKjnwLzy_Wy2ChFFr3iyqSCoWJnaSb3msj_ovEN_p2BqgbaQwYsifzg1r1_x9YKBYZml6PUGoRkc)

ìœ„ì™€ ê°™ì´ ì•„ì£¼ ì˜ ë‚˜ì˜µë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ routes í´ë” ë°‘ì— ìˆëŠ” home.tsx íŒŒì¼ì— Cloudflare D1 DB ê´€ë ¨ ì½”ë“œë¥¼ ë„£ì–´ ì‘ë™ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

---

## D1 DB ì½”ë“œ í…ŒìŠ¤íŠ¸í•˜ê¸°

home.tsx íŒŒì¼ì„ ì—´ì–´ loader í•¨ìˆ˜ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í•˜ê³  Home ì»´í¬ë„ŒíŠ¸ë„ ì•„ë˜ì™€ ê°™ì´ ë°”ê¿‰ë‹ˆë‹¤.

```ts
export async function loader({ context }: Route.LoaderArgs) {
  const db = context.cloudflare.env.DB;

  const results = await db.prepare("SELECT * from todos").run();

  return { results };
}

export default function Home({ loaderData }: Route.ComponentProps) {
  console.log(loaderData);
  return (
    <>
      React Router V7 with Cloudflare D1 DB Test
      <br />
      <br />
      <pre>
        {loaderData?.results && JSON.stringify(loaderData.results, null, 2)}
      </pre>
    </>
  );
}
```

ì´ì œ ê°œë°œì„œë²„ë¥¼ ëŒë ¤ë³¼ê¹Œìš”?

í„°ë¯¸ë„ìƒê³¼ ë¸Œë¼ìš°ì €ì— ë³´ì´ëŠ” ê±´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¬ ê²ë‹ˆë‹¤.

```sh
/react-router-cloudflare-pages-d1-test
> react-router dev

Re-optimizing dependencies because vite config has changed
  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
{
  results: {
    success: true,
    meta: {
      served_by: 'miniflare.db',
      duration: 0,
      changes: 0,
      last_row_id: 0,
      changed_db: false,
      size_after: 12288,
      rows_read: 1,
      rows_written: 0
    },
    results: []
  }
}
```

![](https://blogger.googleusercontent.com/img/a/AVvXsEh4SNy5ko4I6CeJfQN826C9gMYH3XQlQD6mybpdKarmVT454uEHvozYntQN2ZzDYDRoN16B6WOBMtsBsqgilhT5RVsfM-veTJ3NOcnvpMOHst9kdrgWWJd7MffjUhlXQQWw5sINhMK7EH6MI5D7EVjI0R7eCoKGG4YwksK3D1MB-oRMsUtF0uc1KqwQ8MM)

ì•„ì£¼ ì„±ê³µì ìœ¼ë¡œ Cloudflare D1 DBë¥¼ React Routerì˜ loader í•¨ìˆ˜ì—ì„œ ì½ì–´ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.


loader í•¨ìˆ˜ì˜ context ê°ì²´ë¥¼ ì´ìš©í•´ì„œ cloudflareì— ì ‘ê·¼í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## Cloudflare ê´€ë ¨ íƒ€ì… ì •ë³´ ì¶”ê°€í•˜ê¸°

ì•„ë˜ ê·¸ë¦¼ì„ ë³´ì‹œë©´ Cloudflare ê´€ë ¨í•´ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì œëŒ€ë¡œ ì´í•´í•˜ì§€ ëª»í•˜ëŠ”ë°ìš”.

![](https://blogger.googleusercontent.com/img/a/AVvXsEhsG438b5r_tAC5lyc_JrKt0xcwUAhYmy6tiAWyriLgNpCauytj_ttv0slRIfZvto-v97E4ZCVir3eV1szGp-33SheJP2yoGZk_AVgRJlMGVdu2Tccv0sMiXot-wLvAy6pXy4xNyNTky7MGhwHNrJWj_P31ZuMrVTeLQaHgnYcG338AEn0gHIHravLIUn8)

ê°œë°œí•  ë•Œ ì—¬ê°„ ì‹ ê²½ì“°ì´ëŠ”ê²Œ ì•„ë‹™ë‹ˆë‹¤.

ì´ëŸ´ ë•ŒëŠ” ëª¨ë“ˆì„ ì„ ì–¸í•˜ê³  ì—¬ëŸ¬ê°€ì§€ ë¶€ê°€ì ì¸ ì‘ì—…ì„ í•´ì¤˜ì•¼ í•˜ëŠ”ë°ìš”.

ë¨¼ì €, wranglerë¥¼ ì´ìš©í•´ì„œ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ì˜ Env ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

í„°ë¯¸ë„ ìƒì—ì„œ ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•˜ë©´ Env ì¸í„°í˜ì´ìŠ¤ê°€ ìˆëŠ” `worker-configuration.d.ts` íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

```sh
âœ— pnpx wrangler types

 â›…ï¸ wrangler 3.99.0
-------------------

Generating project types...

interface Env {
        DB: D1Database;
}
```

ì´ íŒŒì¼ì€ d.ts íŒŒì¼ì´ê¸° ë•Œë¬¸ì— íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ì½ê²Œ ë©ë‹ˆë‹¤.

ì´ íŒŒì¼ì„ ì˜ ë³´ì‹œë©´ ìš°ë¦¬ê°€ wrangler.toml ìƒì— ì„¤ì •í•œ D1 DBë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í™˜ê²½ íŒŒì¼ Env ë¥¼ ë‚˜íƒ€ë‚´ì¤€ë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ë°ìš”.

ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ í™˜ê²½ë³€ìˆ˜ë„ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.

wrangler.toml íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ VARS ì„¹ì…˜ì„ ì¶”ê°€í•´ ë´…ì‹œë‹¤.

```sh
name = "react-router-cloudflare-pages-d1-test"
compatibility_date = "2024-11-12"
pages_build_output_dir = "./build/client"

[[d1_databases]]
binding = "DB"
database_name = "mydb"
database_id = "5~~~~~~~~~~~~~~~~"

[vars]
MY_SECRET = "react_router_v7_is_cool"
```

ì´ì œ ë‹¤ì‹œ 'npx wrangler types` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ ë´…ì‹œë‹¤.

```sh
âœ— pnpx wrangler types

 â›…ï¸ wrangler 3.99.0
-------------------

Generating project types...

interface Env {
        MY_SECRET: "react_router_v7_is_cool";
        DB: D1Database;
}
```

ì–´ë–¤ê°€ìš”?

wrangler.toml íŒŒì¼ì˜ ë‚´ìš©ì„ ë³´ê³  ì•Œì•„ì„œ ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ë¥¼ ì œëŒ€ë¡œ ì‘ì„±í•´ ì¤ë‹ˆë‹¤.

ì, ì´ì œ React Routerì™€ Cloudflareë¥¼ ì—°ê²°í•˜ëŠ” íŒŒì¼ì„ ì‘ì„±í•´ì•¼ í•˜ëŠ”ë°ìš”.

React Router ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œëŠ” app í´ë” ë°‘ì— env.ts íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ëŠ” ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤.

app í´ë” ë°‘ì— env.ts íŒŒì¼ì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.

```ts
import { type PlatformProxy } from "wrangler";

type Cloudflare = Omit<PlatformProxy<Env>, "dispose">;

declare module "react-router" {
  interface AppLoadContext {
    cloudflare: Cloudflare;
  }
}

export {}; // necessary for TS to treat this as a module
```

ìœ„ì™€ ê°™ì´ "react-router" ëª¨ë“ˆì„ ì„ ì–¸í•˜ë©´ AppLoadContextë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ë‹¤ì‹œ home.tsx íŒŒì¼ë¡œ ë“¤ì–´ê°€ ë³¼ê¹Œìš”?

![](https://blogger.googleusercontent.com/img/a/AVvXsEjD5U75Sc3HrElem9qsLXzPxFE5TL5swmIwIAcCK1t0pMnminnMpV_pf6-96MsYk3p1B87wAhDdjpTnBwqFdF_WPjwXhv-CPfpo_1IubTtgUMOp520mXF4dO5ux3WByHv0JfkizDVEXcmQSXC-fgrf5XqENR2ch_4nGeXpWZsPeTt0rrRfxJLRASCJt8ak=w320-h47)

![](https://blogger.googleusercontent.com/img/a/AVvXsEhTEBrTolXCcUn6d277DVYtERl8SyLP_WIOlOghwYmTEm8jJcJuDg0-XjSOLNsn40GL-hNqi8mOp7ga__7Zj5v_01-FZh6IdttnQC1KloTaoKm7jHDziHkTB8DI0rGQWX_rvrqm90lq0GiFRAFL-SrUlI275WLpeV7eXemLPerJgYariG3VzfRmNZYHAIs)

![](https://blogger.googleusercontent.com/img/a/AVvXsEgklSdLAN7Uow9IM5X6u_D37tNLNZS4tZqWvbGBIsc1eT5P74jBWLiH1kEWEmDXMSTYwchpQGJjba0tf6lyb6oYuAuWjAeImL2KkKCTYjdCboVzyaeP2Q9iNK9EA2tt2pRiQAM5tmdnwzhysRx0e9PZrYasPGG11PnA3VuXoqaZeUGKeHzhmIZQCuxNJ8M)

ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ ì™„ë²½í•˜ê²Œ Cloudflare ê´€ë ¨ íƒ€ì… ì •ë³´ë¥¼ ì–»ê³  ìˆìŠµë‹ˆë‹¤.

ì‹¬ì§€ì–´ ë§ˆì§€ë§‰ì— ë³´ì‹œë©´ MY_SECRET ê°™ì€ ë¡œì»¬ ë³€ìˆ˜ì—ë„ ì ‘ê·¼í•  ìˆ˜ ê°€ ìˆìŠµë‹ˆë‹¤.

---

## package.json íŒŒì¼ scripts ì†ë³´ê¸°

ì, ì§€ê¸ˆê¹Œì§€ ì™„ë²½í•˜ê²Œ React Routerì™€ Cloudflare ê°„ì˜ íƒ€ì… ì •ë³´ê¹Œì§€ êµ¬í˜„í–ˆëŠ”ë°ìš”.

ì´ì œ ê°œë°œ ì„œë²„ë¥¼ ì‰½ê²Œ ëŒë¦¬ê¸° ìœ„í•œ package.json íŒŒì¼ì˜ scripts ë¶€ë¶„ì„ ì†ë³´ê² ìŠµë‹ˆë‹¤.

Remix í”„ë ˆì„ì›ì—ì„œ ì¼ë¶€ ê°€ì ¸ì˜¨ê²ë‹ˆë‹¤.

```sh
  "scripts": {
    "build": "cross-env NODE_ENV=production react-router build",
    "dev": "react-router dev",
    "start": "cross-env NODE_ENV=production react-router-serve ./build/server/index.js",
    "typecheck": "react-router typegen && tsc",
    "deploy": "npm run build && wrangler pages deploy",
    "typegen": "wrangler types"
  },
```

ìœ„ì™€ ê°™ì´ deployì™€ typegen í•­ëª© ë‘ ê°œë§Œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ì´ì œ ì™„ë²½í•œ ê°œë°œì„œë²„ë¥¼ í™˜ê²½ì„ êµ¬ì¶•í•œê²ë‹ˆë‹¤.

ì‹¤ì œ ë°°í¬í•´ ë³¼ê¹Œìš”?

```sh
âœ— pnpm run deploy

> react-router-cloudflare-pages-d1-test@ deploy /Users/cpro95/Codings/Javascript/react-router-test/react-router-cloudflare-pages-d1-test
> npm run build && wrangler pages deploy


> build
> cross-env NODE_ENV=production react-router build

vite v5.4.11 building for production...
âœ“ 48 modules transformed.
build/client/.vite/manifest.json                  1.68 kB â”‚ gzip:  0.43 kB
build/client/assets/logo-dark-pX2395Y0.svg        6.10 kB â”‚ gzip:  2.40 kB
build/client/assets/logo-light-CVbx2LBR.svg       6.13 kB â”‚ gzip:  2.41 kB
build/client/assets/app-Ckulty-W.css              7.33 kB â”‚ gzip:  2.13 kB
build/client/assets/with-props-BJdOiEPt.js        0.35 kB â”‚ gzip:  0.21 kB
build/client/assets/home-B8OacU6i.js              0.49 kB â”‚ gzip:  0.35 kB
build/client/assets/root-CzEkcZd-.js              1.19 kB â”‚ gzip:  0.67 kB
build/client/assets/chunk-K6AXKMTT-DycbfBQN.js  105.32 kB â”‚ gzip: 35.59 kB
build/client/assets/entry.client-u-M4TmH-.js    178.81 kB â”‚ gzip: 56.77 kB
âœ“ built in 707ms
vite v5.4.11 building SSR bundle for production...
âœ“ 11 modules transformed.
build/server/.vite/manifest.json             0.74 kB
build/server/assets/logo-dark-pX2395Y0.svg   6.10 kB
build/server/assets/logo-light-CVbx2LBR.svg  6.13 kB
build/server/assets/app-Ckulty-W.css         7.33 kB
build/server/index.js                        6.25 kB
âœ“ built in 47ms
âœ” The project you specified does not exist: "react-router-cloudflare-pages-d1-test". Would you like to create it? â€º Create a new project
âœ” Enter the production branch name: â€¦ main
âœ¨ Successfully created the 'react-router-cloudflare-pages-d1-test' project.
â–² [WARNING] Warning: Your working directory is a git repo and has uncommitted changes

  To silence this warning, pass in --commit-dirty=true


âœ¨ Compiled Worker successfully
âœ¨ Success! Uploaded 10 files (1.90 sec)

âœ¨ Uploading Functions bundle
ğŸŒ Deploying...
âœ¨ Deployment complete! Take a peek over at https://c2b0d507.react-router-cloudflare-pages-d1-test.pages.dev
```

ìœ„ì™€ ê°™ì´ ì²˜ìŒ ì‹¤í–‰í•˜ë©´ Cloudflare Pages ê´€ë ¨ Create a new project ë¬¸êµ¬ê°€ ë‚˜ì˜¤ë©´ì„œ í™€ë”©ë˜ëŠ”ë° ì—”í„°í‚¤ ë‘ ë²ˆ ì¹˜ë©´ ì‹¤í–‰ë©ë‹ˆë‹¤.

branch_nameì€ ê¸°ë³¸ì ìœ¼ë¡œ mainìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ì œ ì›¹ìƒì—ì„œ ì‚´í´ë³¼ê¹Œìš”?

ì‹¤ì œë¡œ ì›¹ìƒì— êµ¬í˜„ë˜ë ¤ë©´ ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë¦¬ë‹ˆê¹Œ ë¸Œë¼ìš°ì €ì—ì„œ ìƒˆë¡œê³ ì¹¨ì„ ëª‡ ë²ˆ í•´ë³´ë©´ ë©ë‹ˆë‹¤.

ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ë‚˜ì˜¬ ê²ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEjUJCp61Bu-60kOl5DQ7GfSzNwgCyuVIWFkcxZRjqXRTCspYVyYZVYqSUtF8e9gEI0CKkjytZd9HakS1-iYcrHYLPxByk3R0ccnaHgQTBqPIuAXTphD0U_VBaNoemSHeAfdaYTyCb2CW4vHkxpTKiPJG-d-IQPWP4Uw0pzm7KGZO7R9H7KjF7wrDaGCaUk)

ì•„ì£¼ ì˜ ë‚˜ì˜¤ë„¤ìš”.

ì›¹ìƒì—ì„œë„ D1 DBì— ì„±ê³µì ìœ¼ë¡œ ì ‘ê·¼í•˜ê³  ìˆë„¤ìš”.

ëŒ€ì„±ê³µì…ë‹ˆë‹¤.

ê·¸ëŸ¼ ì•ìœ¼ë¡œ React Router V7ì„ ì´ìš©í•´ì„œ Cloudflareì˜ ê°ì¢… ì„œë¹„ìŠ¤ë¥¼ ë§ˆìŒê» ê³µì§œë¡œ ì´ìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

ë.

