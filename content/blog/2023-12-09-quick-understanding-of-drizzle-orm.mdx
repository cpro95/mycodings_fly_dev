---
slug: 2023-12-09-quick-understanding-of-drizzle-orm
title: Drizzle ORM ì‰½ê²Œ ì´í•´í•˜ê¸°
date: 2023-12-09T06:58:01.961Z
description: Cloudflare D1 DBì— ì“¸ ìˆ˜ ìˆëŠ” Drizzle ORMì— ëŒ€í•´ ì•Œì•„ë³´ì.
meta:
  keywords:
    - drizzle
    - orm
published: true
---

# Drizzle ORM ì‰½ê²Œ ì´í•´í•˜ê¸°

ì•ˆë…•í•˜ì„¸ìš”?

ì˜¤ëŠ˜ì€ Typescript ORMìœ¼ë¡œ ëŒ€í‘œë˜ëŠ” Prismaì˜ ëŒ€í•­ë§ˆë¡œ ìµœê·¼ ì£¼ëª©ë°›ê³  ìˆëŠ” Drizzle ORMì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

Drizzle ORMì€ MySQL, PostgreSQL, Sqliteë¥¼ ì§€ì›í•©ë‹ˆë‹¤ë§Œ ì—¬ê¸°ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ Sqliteë¥¼ ì´ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤.

** ëª© ì°¨ **

1. [Drizzle ORMì´ë€?](#1-drizzle-ormì´ë€)

2. [í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•](#2-í…ŒìŠ¤íŠ¸-í™˜ê²½-êµ¬ì¶•)

   2.1 [Typescript ì„¤ì¹˜](#2-1-typescript-ì„¤ì¹˜)

   2.2 [Drizzle ì„¤ì¹˜](#2-2-drizzle-ì„¤ì¹˜)

3. [Drizzle ì„¤ì •](#3-drizzle-ì„¤ì •)

   3.1 [ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì‘ì„±](#3-1-ìŠ¤í‚¤ë§ˆ-íŒŒì¼-ì‘ì„±)

   3.2 [ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ë§Œë“¤ê¸°](#3-2-ë§ˆì´ê·¸ë ˆì´ì…˜-íŒŒì¼-ë§Œë“¤ê¸°)

   3.3 [DBì— ì—°ê²°í•˜ê¸°](#3-3-dbì—-ì—°ê²°í•˜ê¸°)

4. [ì‹¤ì œ Drizzle ORM í…ŒìŠ¤íŠ¸í•´ ë³´ê¸°](#4-ì‹¤ì œ-drizzle-orm-í…ŒìŠ¤íŠ¸í•´-ë³´ê¸°)

5. [ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ë™ ë°©ì‹ ì•Œì•„ë³´ê¸°](#5-ë§ˆì´ê·¸ë ˆì´ì…˜-ì‘ë™-ë°©ì‹-ì•Œì•„ë³´ê¸°)

   5.1 [Column ì¶”ê°€](#5-1-column-ì¶”ê°€)

   5.2 [Column ì‚­ì œ](#5-2-column-ì‚­ì œ)

   5.3 [ë§ˆì´ê·¸ë ˆì´ì…˜ drop í•˜ê¸°](#5-3-ë§ˆì´ê·¸ë ˆì´ì…˜-drop-í•˜ê¸°)

6. [ì„¤ì • íŒŒì¼](#6-ì„¤ì •-íŒŒì¼)

7. [InferModelì„ ì´ìš©í•œ íƒ€ì… ì„¤ì •í•˜ê¸°](#7-infermodelì„-ì´ìš©í•œ-íƒ€ì…-ì„¤ì •í•˜ê¸°)

8. [ì‹¤í–‰í•œ SQL ë‚´ìš© í™•ì¸í•˜ê¸°](#8-ì‹¤í–‰í•œ-sql-ë‚´ìš©-í™•ì¸í•˜ê¸°)

9. [ë¡œê¹… ì„¤ì •](#9-ë¡œê¹…-ì„¤ì •)

---

## 1. Drizzle ORMì´ë€?

Drizzle ORMì˜ ë…íŠ¹í•œ ì¥ì ì´ì íŠ¹ì§•ì€ SQL-Likeí•˜ê²Œ ì½”ë“œì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°ì‘ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” Typescript ORMì…ë‹ˆë‹¤.

Prismaë„ Typescript ORMì¸ë°ìš”.

Prismaì˜ ë¬¸ë²•ì´ ì‹¤ì œ SQL ë¬¸ë²•ê³¼ ë‹¤ë¥´ë‹¤ëŠ” ë°ì„œ ì¶œë°œí•œ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ Drizzle ORMì—ì„œëŠ” SQL ë¬¸ë²•ì„ ì•Œë©´ Drizzle ë¬¸ë²•ë„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë‹¤ê³  ì–˜ê¸°í•˜ê³  ìˆì£ .

ìµœê·¼ì—ëŠ” [Payload CMS](https://payloadcms.com/)ì—ì„œë„ ì´ìš©ë˜ê³  ìˆìœ¼ë©°, Payload CMSëŠ” Drizzle ORMì„ ì´ìš©í•˜ì—¬ PostgreSQLì„ ì§€ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ORMì€ Object Relational Mappingì˜ ì•½ìë¡œ, MySQL, PostgreSQL, SQLiteì™€ ê°™ì€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•´ SQL ëŒ€ì‹  ê°ì²´ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.

ê°ì²´ ë©”ì„œë“œê°€ ì–´ë–¤ ê²ƒì¸ì§€ì— ëŒ€í•œ ì´í•´ëŠ” ì˜¤ëŠ˜ ì´ ê¸€ì„ ëê¹Œì§€ ì½ìœ¼ì‹œë©´ ì´í•´í•  ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

---

## 2. í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•

### 2-1. Typescript ì„¤ì¹˜

ì˜¤ëŠ˜ Typescriptë¥¼ ì´ìš©í•´ì„œ í„°ë¯¸ë„ ìƒì—ì„œ Drizzle ORMì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ë‚˜ì¤‘ì— ì›¹ì—ì„œë„ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆìœ¼ë‹ˆ ê±±ì •í•˜ì§€ ì•Šìœ¼ì…”ë„ ë©ë‹ˆë‹¤.

```bash
mkdir drizzle-test

cd drizzle-test

npm init -y

npm install -D typescript ts-node @types/node
```

ìœ„ ëª…ë ¹ì–´ê°€ ë­”ì§€ëŠ” ë‹¤ë“¤ ì•„ì‹¤ ê²ë‹ˆë‹¤.

ì´ì œ 'npx tsc --init' ëª…ë ¹ì–´ë¡œ Typescript êµ¬ì„±íŒŒì¼ì¸ tsconfig.ts íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ê² ì£ .

```bash
npx tsc --init

Created a new tsconfig.json with:
                                                                                                    TS
  target: es2016
  module: commonjs
  strict: true
  esModuleInterop: true
  skipLibCheck: true
  forceConsistentCasingInFileNames: true


You can learn more at https://aka.ms/tsconfig
```

---

### 2-2. Drizzle ì„¤ì¹˜

ì´ì œ Drizzle íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ”ë°ìš”.

Drizzle íŒ¨í‚¤ì§€ëŠ” Sqlite3ë¥¼ ì‚¬ìš©í•  ë•Œ better-sqlite3ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

PostgreSQL, MySQL ê°™ì€ ê²½ìš°ëŠ” ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ë©´ ì–´ë–¤ ê±¸ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
npm install drizzle-orm better-sqlite3

npm i --save-dev @types/better-sqlite3
```

ê·¸ë¦¬ê³  Drizzleì„ ì¢€ ë” ì‰½ê²Œ ì´ìš©í•˜ê²Œ í•´ì£¼ëŠ” Drizzle-kitì„ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ”ë°ìš”.

Drizzle-kitì€ ìŠ¤í‚¤ë§ˆ íŒŒì¼ë¡œ ì‰½ê²Œ Drizzleì„ ì´ìš©í•  ìˆ˜ ìˆê²Œ í•´ ì¤ë‹ˆë‹¤.

```bash
npm install -D drizzle-kit
```

ì´ì œ ì¤€ë¹„ê°€ ëë‚¬ë„¤ìš”.

ì™„ë£Œëœ package.json íŒŒì¼ì„ ë³¼ê¹Œìš”?

```json
{
  "name": "drizzle-test",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@types/better-sqlite3": "^7.6.8",
    "@types/node": "^20.10.4",
    "drizzle-kit": "^0.20.6",
    "ts-node": "^10.9.2",
    "typescript": "^5.3.3"
  },
  "dependencies": {
    "better-sqlite3": "^9.2.2",
    "drizzle-orm": "^0.29.1"
  }
}
```

---

## 3. Drizzle ì„¤ì •

ë³´í†µ Drizzle ORM ì„¤ì •ì„ ìœ„í•´ ìŠ¤í‚¤ë§ˆ íŒŒì¼ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ìœ„í•œ ì½”ë“œë¥¼ í•œ ê³³ì— ëª¨ì•„ë‘ëŠ”ë°ìš”.

ìš°ë¦¬ëŠ” 'db'ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

```bash
mkdir db
```

### 3-1. ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì‘ì„±

ìŠ¤í‚¤ë§ˆ(Schema)ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ëŠ” ì •ë³´ì…ë‹ˆë‹¤.

ê°„ë‹¨íˆ ë§í•˜ë©´, í…Œì´ë¸”(table)ì´ ì–´ë–¤ ì—´(column)ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , ê°ê°ì˜ ì—´(column)ì— ì–´ë–¤ ë°ì´í„°ë¥¼ ì €ì¥í• ì§€ ì •ì˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ìŠ¤í‚¤ë§ˆ íŒŒì¼ì€ í•˜ë‚˜ì˜ íŒŒì¼ì— ëª¨ë‘ ì •ì˜í•˜ëŠ” ë°©ë²•ê³¼ ê°ê°ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ë³„ë„ íŒŒì¼ë¡œ ë‚˜ëˆ„ì–´ ì €ì¥í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ì€ í•˜ë‚˜ì˜ íŒŒì¼ì— ëª¨ë‘ ì •ì˜í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

"db" ë””ë ‰í† ë¦¬ì— "schema.ts" íŒŒì¼ì„ ë§Œë“¤ê³ , ì•„ë˜ ì½”ë“œë¥¼ ì ìì‹œë‹¤.

ì•„ë˜ ì½”ë“œëŠ” "todos" í…Œì´ë¸”ì„ SQLite ë°ì´í„°ë² ì´ìŠ¤ì— ë§Œë“¤ê²Œ ë©ë‹ˆë‹¤.

"todos" í…Œì´ë¸”ì€ id, name, isCompleted ì—´(column)ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, idëŠ” ìë™ìœ¼ë¡œ ìˆ«ìê°€ í• ë‹¹ë˜ëŠ” autoIncrement ë°©ì‹ì…ë‹ˆë‹¤.

nameì€ ë¬¸ìì—´ì´ê³ , isCompletedì—ëŠ” boolean íƒ€ì…ì´ ì˜µë‹ˆë‹¤.

Sqlite3ì—ì„œ Boolean íƒ€ì…ì€ falseê°€ 0, trueê°€ 1ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì‚¬ì‹¤ isCompletedì—ëŠ” number íƒ€ì…ì´ ì˜¤ê²Œ ë˜ì£ .

Drizzle ORMì´ ì•Œì•„ì„œ Boolean íƒ€ì…ì„ ìˆ«ìë¡œ ë³€í™˜ì‹œì¼œ ì¤ë‹ˆë‹¤.

```js
// ./db/schema.ts íŒŒì¼

import { text, integer, sqliteTable } from 'drizzle-orm/sqlite-core'

export const todos = sqliteTable('todos', {
  id: integer('id', { mode: 'number' }).primaryKey({ autoIncrement: true }),
  name: text('name'),
  isCompleted: integer('isCompleted', { mode: 'boolean' })
    .notNull()
    .default(false),
})
```

---

### 3-2. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ë§Œë“¤ê¸°

ì´ì œ Drizzle ORMì„ ì´ìš©í•œ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì‹¤ì œ ì´ íŒŒì¼ì„ ì´ìš©í•´ì„œ SQLì— ì ìš©í•˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ë°ìš”.

Drizzle-kit íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ ì´ìœ ê°€ ì—¬ê¸°ì— ìˆìŠµë‹ˆë‹¤.

'npx drizzle-kit' ëª…ë ¹ì–´ë¡œ ìš°ë¦¬ê°€ ë§Œë“  schema íŒŒì¼ì„ ì§€ì •í•´ ì£¼ë©´ ì•Œì•„ì„œ ë§Œë“¤ì–´ì£¼ëŠ”ë°ìš”.

```bash
npx drizzle-kit generate:sqlite --schema=./db/schema.ts

drizzle-kit: v0.20.6
drizzle-orm: v0.29.1

1 tables
todos 3 columns 0 indexes 0 fks

[âœ“] Your SQL migration file âœ drizzle/0000_burly_spyke.sql ğŸš€
```

ìœ„ì™€ ê°™ì´ ì‹¤í–‰ë˜ê³  drizzle í´ë”ì— '0000_burly_spyke.sql'ë¼ëŠ” ì´ë¦„ì´ ë§Œë“¤ì–´ì¡ŒëŠ”ë°ìš”.

ì´ íŒŒì¼ì„ ì—´ì–´ë³¼ê¹Œìš”?

```sql
CREATE TABLE `todos` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` text,
	`isCompleted` integer DEFAULT false NOT NULL
);
```

ìš°ë¦¬ê°€ schema.ts íŒŒì¼ì— Drizzle ORM ë¬¸ë²•ìœ¼ë¡œ todos í…Œì´ë¸”ì„ ë§Œë“¤ì—ˆì—ˆëŠ”ë°, ê·¸ê±¸ ì‹¤ì œ SQLë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜(ì´ë™)í•œ ê²ë‹ˆë‹¤.

ìœ„ SQL íŒŒì¼ì—ëŠ” CREATE TABLE ëª…ë ¹ì–´ê°€ ìˆë„¤ìš”.

ì´ íŒŒì¼ì„ ì´ìš©í•˜ë©´ ì‹¤ì œ Sqlite DBì— TABLEë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 3-3. DBì— ì—°ê²°í•˜ê¸°

ì´ì œ ìŠ¤í‚¤ë§ˆ íŒŒì¼ë„ ë§Œë“¤ì—ˆê³  ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ì´ìš©í•´ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ë„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì½”ë“œì— ì‚¬ìš©í•  DB ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.

db í´ë”ì— 'db.ts'ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ë§Œë“­ì‹œë‹¤.

```js
import { drizzle, BetterSQLite3Database } from 'drizzle-orm/better-sqlite3'
import { migrate } from 'drizzle-orm/better-sqlite3/migrator'
import Database from 'better-sqlite3'

const sqlite = new Database('./db/mysqlite.db')
export const db: BetterSQLite3Database = drizzle(sqlite)

migrate(db, { migrationsFolder: './drizzle' })
```

ìœ„ ì½”ë“œëŠ” ê·¸ëƒ¥ Drizzle ORMì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë‹¹ì—°í•œ ì½”ë“œì´ê¸° ë•Œë¬¸ì— ê³µì‹ë¬¸ì„œì—ì„œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ë©´ ë˜ëŠ” ê²ë‹ˆë‹¤.

ë‹¨ì§€, db í´ë” ë°‘ì— 'mysqlite.db'ë¼ëŠ” ì‹¤ì œ íŒŒì¼ì´ë¦„ì„ ì§€ì •í•œ ê²ƒë§Œ ë‹¤ë¥´ì£ .

ê·¸ë¦¬ê³  ì´ 'db.ts'íŒŒì¼ì˜ ë§ˆì§€ë§‰ì—ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ë¼ëŠ” 'migrate' ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.

ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”ëŠ” './drizzle' í´ë”ê°€ ë˜ëŠ” ê±°ê³ ìš”.

í…Œì´ë¸” êµ¬ì„±ì„ ë³€ê²½í•˜ëŠ” ê²½ìš° ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë‹¤ì‹œ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

---

## 4. ì‹¤ì œ Drizzle ORM í…ŒìŠ¤íŠ¸í•´ ë³´ê¸°

ì§€ê¸ˆê¹Œì§€ëŠ” Drizzle ORMì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ db ê´€ë ¨ ì‚¬ì „ ì‘ì—…ì´ì—ˆë‹¤ë©´ ì´ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ ë´ì•¼ê² ì£ .

í”„ë¡œì íŠ¸ ìµœìƒë‹¨ ì¦‰, package.json íŒŒì¼ê³¼ ê°™ì€ ìœ„ì¹˜ì— 'index.ts'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“­ë‹ˆë‹¤.

ì¼ë‹¨ ë³´ì‹œì£ .

```js
import { db } from './db/db'
import { todos } from './db/schema'

function main() {
  const allTodo = db.select().from(todos).all()
  console.log(allTodo)
}

main()
```

Drizzle ORMì˜ ë¬¸ë²•ì€ SQL ë¬¸ë²•ê³¼ ì•„ì£¼ ë¹„ìŠ·í•œë°ìš”.

SQL ë¬¸ë²•ì´ 'select \* from table_name;' ì´ëŸ° ì‹ì´ì–ì•„ìš”.

ìœ„ ì½”ë“œë¥¼ ë³´ì‹œë©´ ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ê°ì²´ì˜ ë©”ì„œë“œê°€ ì²´ì´ë‹ ë©ë‹ˆë‹¤.

'db.selecct().from(todos).all()'

db ê°ì²´ ë‹¤ìŒì— ì˜¤ëŠ” ê±´ ì „ë¶€ ë©”ì„œë“œì¸ë°ìš”.

í•¨ìˆ˜ì¸ ê±°ì£ .

ë©”ì„œë“œ ì²´ì´ë‹ ë°©ì‹ìœ¼ë¡œ ë§ˆì§€ë§‰ì— ìˆëŠ” ê±´ 'all' ë©”ì„œë“œì¸ë°ìš”.

'select _ from table_name'ì—ì„œ '_'ë¥¼ ëœ»í•˜ëŠ” 'all'ì…ë‹ˆë‹¤.

ì‹¤í–‰í•´ ë³¼ê¹Œìš”?

```bash
npx ts-node index.ts
[]
```

ìœ„ì™€ ê°™ì´ ë¹ˆ ë¸Œë¼ì¼“ë§Œ ë‚˜ì˜µë‹ˆë‹¤.

ì™œëƒí•˜ë©´ ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì´ì£ .

---

### 4-1. ë°ì´í„° insert í•˜ê¸°

insert ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ SQLì—ì„œì˜ insert ëª…ë ¹ì–´ë¥¼ êµ¬í˜„í•´ ë³¼ê¹Œìš”?

```js
import { db } from './db/db'
import { todos } from './db/schema'

async function main() {
  const result = db
    .insert(todos)
    .values({ name: 'test 1', isCompleted: false })
    .run()
  console.log('result', result)

  const allTodo = db.select().from(todos).all()
  console.log('allTodo', allTodo)
}

main()
```

insert ê°™ì€ ê²½ìš°ëŠ” async í•¨ìˆ˜ë¡œ êµ¬í˜„í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

insert ë¬¸êµ¬ë„ SQL ë¬¸ë²•ì¸ 'insert into todos values;' ìˆœì„œì…ë‹ˆë‹¤.

values ë©”ì„œë“œì—ëŠ” ê°ì²´ë¥¼ ë„£ì–´ì£¼ë©´ ë˜ì£ .

run ë©”ì„œë“œëŠ” insert, delete, update ê°™ì€ ëª…ë ¹ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.

select ë©”ì„œë“œëŠ” all ë©”ì„œë“œëŠ” ì‚¬ìš©í–ˆê³ ìš”.

í…ŒìŠ¤íŠ¸í•´ ë³¼ê¹Œìš”?

```bash
npx ts-node index.ts

result { changes: 1, lastInsertRowid: 1 }
allTodo [ { id: 1, name: 'test 1', isCompleted: false } ]
```

ìœ„ì™€ ê°™ì´ ë‚˜ì˜¤ë„¤ìš”.

ì‹¤ì œ sqliteëŠ” ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜µë‹ˆë‹¤.

```bash
# í„°ë¯¸ë„ì—ì„œ sqlite3 ëª…ë ¹ì–´ë¡œ select í–ˆì„ ê²½ìš°

sqlite3 ./db/mysqlite.db
SQLite version 3.37.0 2021-12-09 01:34:53
Enter ".help" for usage hints.
sqlite> select * from todos;
1|test 1|0
sqlite>
```

ì—­ì‹œë‚˜ isCompletedëŠ” ì‹¤ì œ ìˆ«ìë¡œ ì €ì¥ë˜ëŠ”êµ°ìš”.

í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ëª‡ ê°œ ë” ì €ì¥í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```bash
npx ts-node index.ts

result { changes: 1, lastInsertRowid: 6 }
allTodo [
  { id: 1, name: 'test 1', isCompleted: false },
  { id: 2, name: 'test 2', isCompleted: false },
  { id: 3, name: 'test 3', isCompleted: false },
  { id: 4, name: 'test 4', isCompleted: true },
  { id: 5, name: 'test 5', isCompleted: true },
  { id: 6, name: 'test 6', isCompleted: false }
]
```

ì´ 6ê°œì˜ ë°ì´í„°ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

---

### 3-2. select ë©”ì„œë“œ ì˜µì…˜ ì‚¬ìš©í•˜ê¸°

Drizzle ORMì—ì„œ select ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ ì˜µì…˜ì„ ì¤„ ìˆ˜ ìˆëŠ”ë°ìš”.

```js
const allTodo = db.select().from(todos).get()
```

ìœ„ì™€ ê°™ì´ get ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ resultì—ì„œ ë§¨ ì²˜ìŒ í•œ ê°œë§Œ ë½‘ì•„ì¤ë‹ˆë‹¤.

```bash
npx ts-node index.ts

allTodo { id: 1, name: 'test 1', isCompleted: false }
```

ë°”ë¡œ ì²« ë²ˆì§¸ ê²°ê³¼ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ê±°ì£ .

ê·¸ëŸ¬ë©´ 3ê°œë§Œ ê°€ì ¸ì˜¤ë ¤ë©´ ì–´ë–»ê²Œ í• ê¹Œìš”?

```js
const allTodo = db.select().from(todos).limit(3).all()
```

limit ë©”ì„œë“œì— ìˆ«ìë¥¼ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.

ì‹¤í–‰ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```bash
npx ts-node index.ts

allTodo [
  { id: 1, name: 'test 1', isCompleted: false },
  { id: 2, name: 'test 2', isCompleted: false },
  { id: 3, name: 'test 3', isCompleted: false }
]
```

ê·¸ëŸ¬ë©´ ì „ì²´ ê°œìˆ˜ëŠ” ì–´ë–»ê²Œ ì…€ê¹Œìš”?

```js
import { db } from './db/db'
import { todos } from './db/schema'
import { count } from 'drizzle-orm'

async function main() {
  const allTodo = await db.select({ value: count() }).from(todos)
  console.log('allTodo', allTodo)
}

main()
```

ìœ„ì™€ ê°™ì´ ë³„ë„ count í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ì‹¤í–‰ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```bash
npx ts-node index.ts

allTodo [ { value: 6 } ]
```

ê³µì‹ ë¬¸ì„œì—ëŠ” ì•„ì£¼ ë§ì€ ìœ í˜•ì˜ ì˜ˆì œê°€ ìˆìœ¼ë‹ˆ ê¼­ ê³µë¶€í•˜ì‹œê¸°ë¥¼ ë°”ëë‹ˆë‹¤.

ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ name í•­ëª©ë§Œ select í•˜ê³  ì‹¶ì„ ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ ë©ë‹ˆë‹¤.

```js
import { db } from './db/db'
import { todos } from './db/schema'

async function main() {
  const allTodo = await db.select({ name: todos.name }).from(todos)
  console.log('allTodo', allTodo)
}

main()
```

ì‹¤í–‰ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```bash
npx ts-node index.ts

allTodo [
  { name: 'test 1' },
  { name: 'test 2' },
  { name: 'test 3' },
  { name: 'test 4' },
  { name: 'test 5' },
  { name: 'test 6' }
]
```

---

## 5. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ë™ ë°©ì‹ ì•Œì•„ë³´ê¸°

ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ì•„ëŠ” ê²Œ ì¤‘ìš”í•œë°ìš”.

### 5-1. Column ì¶”ê°€

schema.ts íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ userë¼ëŠ” í•­ëª©ì„ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
import { text, integer, sqliteTable } from 'drizzle-orm/sqlite-core'

export const todos = sqliteTable('todos', {
  id: integer('id', { mode: 'number' }).primaryKey({ autoIncrement: true }),
  name: text('name'),
  user: text('user'),
  isCompleted: integer('isCompleted', { mode: 'boolean' })
    .notNull()
    .default(false),
})
```

ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ìˆ˜ì •í–ˆìœ¼ë©´ Drizzle-kit íŒ¨í‚¤ì§€ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
npx drizzle-kit generate:sqlite --schema=./db/schema.ts

drizzle-kit: v0.20.6
drizzle-orm: v0.29.1

1 tables
todos 4 columns 0 indexes 0 fks

[âœ“] Your SQL migration file âœ drizzle/0001_classy_blizzard.sql ğŸš€
```

ìœ„ì™€ ê°™ì´ '0001_classy_blizzard.sql'ì´ë¼ëŠ” sql íŒŒì¼ì´ ìƒê²¼ëŠ”ë°ìš”.

ì‹¤ì œ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```sql
ALTER TABLE todos ADD `user` text;
```

todos í…Œì´ë¸”ì— user í•­ëª©ì„ ì¶”ê°€í•˜ë¼ëŠ” SQL ëª…ë ¹ì–´ì…ë‹ˆë‹¤.

ì‹¤ì œ ì½”ë“œì—ì„œëŠ” ì–´ë–»ê²Œ ë‚˜ì˜¬ê¹Œìš”?

```js
import { db } from './db/db'
import { todos } from './db/schema'

async function main() {
  const allTodo = db.select().from(todos).all()
  console.log('allTodo', allTodo)
}

main()
```

index.ts íŒŒì¼ì„ ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ê³  ê²°ê³¼ë¥¼ ë³¼ê¹Œìš”?

```bash
npx ts-node index.ts

allTodo [
  { id: 1, name: 'test 1', user: null, isCompleted: false },
  { id: 2, name: 'test 2', user: null, isCompleted: false },
  { id: 3, name: 'test 3', user: null, isCompleted: false },
  { id: 4, name: 'test 4', user: null, isCompleted: true },
  { id: 5, name: 'test 5', user: null, isCompleted: true },
  { id: 6, name: 'test 6', user: null, isCompleted: false }
]
```

user í•­ëª©ì´ ì „ë¶€ nullë¡œ ì§€ì •ë˜ì–´ ìˆë„¤ìš”.

ë‹¹ì—°íˆ í…Œì´ë¸”ì„ ì¤‘ê°„ì— ìˆ˜ì •í–ˆìœ¼ë‹ˆ ê¸°ë³¸ê°’ì¸ nullì´ ì €ì¥ë˜ì—ˆë„¤ìš”.

---

### 5-2. Column ì‚­ì œ

ì´ì œëŠ” ë‹¤ì‹œ user í•­ëª©ì„ ë‹¤ì‹œ ì§€ì›Œ ë³´ê² ìŠµë‹ˆë‹¤.

schema.ts íŒŒì¼ì…ë‹ˆë‹¤.

```js
import { text, integer, sqliteTable } from 'drizzle-orm/sqlite-core'

export const todos = sqliteTable('todos', {
  id: integer('id', { mode: 'number' }).primaryKey({ autoIncrement: true }),
  name: text('name'),
  isCompleted: integer('isCompleted', { mode: 'boolean' })
    .notNull()
    .default(false),
})
```

ì´ì œ ë‹¤ì‹œ dirzzle-kitìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìˆ˜í–‰í•´ ë³¼ê¹Œìš”?

```bash
npx drizzle-kit generate:sqlite --schema=./db/schema.ts

drizzle-kit: v0.20.6
drizzle-orm: v0.29.1

1 tables
todos 3 columns 0 indexes 0 fks

[âœ“] Your SQL migration file âœ drizzle/0002_grey_spencer_smythe.sql ğŸš€
```

ì—­ì‹œ '0002_grey_spencer_smythe.sql' íŒŒì¼ì´ ìƒê²¼ë„¤ìš”.

```sql
ALTER TABLE `todos` DROP COLUMN `user`;
```

ì´ë²ˆì—ëŠ” DROP ëª…ë ¹ì–´ì…ë‹ˆë‹¤.

ë‹¤ì‹œ index.ts íŒŒì¼ì„ ì‹¤í–‰í•´ ë³¼ê¹Œìš”?

```bash
npx ts-node index.ts

allTodo [
  { id: 1, name: 'test 1', isCompleted: false },
  { id: 2, name: 'test 2', isCompleted: false },
  { id: 3, name: 'test 3', isCompleted: false },
  { id: 4, name: 'test 4', isCompleted: true },
  { id: 5, name: 'test 5', isCompleted: true },
  { id: 6, name: 'test 6', isCompleted: false }
]
```

ì—­ì‹œë‚˜ ê²°ê³¼ëŠ” user í•­ëª©ì´ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.

---

### 5-3. ë§ˆì´ê·¸ë ˆì´ì…˜ drop í•˜ê¸°

ìš°ë¦¬ê°€ ìœ„ì—ì„œ í–ˆë˜ ë‘ ë²ˆì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ê²°êµ­ì€ ì²˜ìŒìœ¼ë¡œ ëŒì•„ì™”ëŠ”ë°ìš”.

ë§ˆì´ê·¸ë ˆì´ì…˜ì„ drop í•˜ëŠ” ê¸°ëŠ¥ë„ ìˆìŠµë‹ˆë‹¤.

```bash
npx drizzle-kit drop --out ./drizzle
```

ìœ„ì™€ ê°™ì´ drizzle í´ë”ë¥¼ '--out' ì˜µì…˜ìœ¼ë¡œ ì§€ì •í•´ì„œ ì‹¤í–‰í•˜ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¦¬ìŠ¤íŠ¸ê°€ ë‚˜ì˜¤ê³  ì—”í„°í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì„ íƒë˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

ë§ˆì§€ë§‰ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì„ íƒí•´ ë³´ì£ .

ê·¸ëŸ¬ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¤ëŠ”ë°ìš”.

```bash
drizzle-kit: v0.20.6
drizzle-orm: v0.29.1


[âœ“] 0002_grey_spencer_smythe migration successfully dropped
```

droppedì´ë¼ê³  ë‚˜ì˜µë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²Œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ì‚­ì œí•  ìˆ˜ëŠ” ìˆì§€ë§Œ ì‚­ì œí•´ë„ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì— ë°˜ì˜ë˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

---

## 6. ì„¤ì • íŒŒì¼

ì§€ê¸ˆê¹Œì§€ ê³„ì† ìŠ¤í‚¤ë§ˆ íŒŒì¼ ìœ„ì¹˜ì™€ drizzle í´ë”ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì§€ì •í–ˆëŠ”ë°ìš”.

í”„ë¡œì íŠ¸ ìµœìƒë‹¨ ìœ„ì¹˜ ì¦‰, package.json íŒŒì¼ê³¼ ê°™ì€ ìœ„ì¹˜ì— 'drizzle.config.ts'íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ë©´ ì•„ì£¼ í¸í•©ë‹ˆë‹¤.

```js
import type { Config } from 'drizzle-kit';

export default {
  schema: './db/schema.ts',
  out: './drizzle',
} satisfies Config;
```

ìœ„ íŒŒì¼ì´ ìˆìœ¼ë©´ 'npx drizzle-kit generate:sqlite' ë¼ê³ ë§Œ ì…ë ¥í•´ë„ ì‘ë™í•˜ê²Œ ë©ë‹ˆë‹¤.

---

## 7. InferModelì„ ì´ìš©í•œ íƒ€ì… ì„¤ì •í•˜ê¸°

ì¼ë‹¨ ì•„ë˜ì™€ ê°™ì€ ì˜ˆì œê°€ ìˆë‹¤ê³  í•©ì‹œë‹¤.

```js
import { db } from './db/db'
import { todos } from './db/schema'

const insertTodo = todo => {
  return db.insert(todos).values(todo).run()
}

async function main() {
  const result = insertTodo({ name: 'test 7', isCompleted: false })
  console.log('result', result)

  const allTodo = db.select().from(todos).all()
  console.log(allTodo)
}

main()
```

ìœ„ ì½”ë“œëŠ” insertTodo ë¼ëŠ” ë³„ë„ì˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆëŠ”ë°ìš”.

![](https://blogger.googleusercontent.com/img/a/AVvXsEh8KbdjFoi_4Iue-db_Xby6JQ8lty0oYYRBjfOBlvyVFWV6q9-XKulPzJnJJTBsdueBEC5sQYnwaTa7-5P4PLAF0Pwwmg1O67A9tx5wtgFsuOFPgfz3630dAkJmGPFxzj6-xdpLU-5kBA89R7rk95J-2h_S9ScqESd9K9iVSzhQ9sHRwZ0_h3rNLy4HLBI)

ìœ„ì™€ ê°™ì´ todo ì¸ìì— ëŒ€í•´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ê²½ê³ ë¥¼ ë³´ë‚´ê³  ìˆì£ .

ì´ì™€ ê°™ì€ íƒ€ì… ë¬¸ì œì— ìˆì–´ Drizzle ORM ì€ í—¬í¼ ìœ í‹¸ì„ ì œê³µí•´ ì£¼ëŠ”ë°ìš”.

insertTodo í•¨ìˆ˜ì—ëŠ” db.insert() ëª…ë ¹ì–´ê°€ ìˆì£ .

ê·¸ëŸ¬ë©´ InferInsertModel í—¬í¼ ìœ í‹¸ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```js
import { InferInsertModel } from 'drizzle-orm'
import { db } from './db/db'
import { todos } from './db/schema'

type InsertTodoType = InferInsertModel<typeof todos>

const insertTodo = (todo: InsertTodoType) => {
  return db.insert(todos).values(todo).run()
}

async function main() {
  const result = insertTodo({ name: 'Learn TypeScript', isCompleted: false })
  console.log('result', result)

  const allTodo = db.select().from(todos).all()
  console.log(allTodo)
}
```

![](https://blogger.googleusercontent.com/img/a/AVvXsEjCMyqwJkWNx8tzQMI9ZAWPPj8Yez0JeHV3w2NWEvwNCvbTis2zD0tzhTuhKT0YJG7ODDDVvccs666pkMiDkH3nNCu1BoEQcLI0UgHhavKaiTackfBYANqebcAjCZCBq80n07LZTdt2o86VXrFtiJNZSTvsHNNp_DSfA_y4qmgeKssuyNPv33kJS0tXxnw)

ìœ„ì™€ ê°™ì´ íƒ€ì… ì§€ì •ì´ ê¹”ë”í•˜ê²Œ ëë„¤ìš”.

select ëª…ë ¹ì–´ì¼ ê²½ìš°ì—ë„ í—¬í¼ ìœ í‹¸ì´ ìˆìŠµë‹ˆë‹¤.

```js
type Todo = InferSelectModel<typeof todos>;
...
...
...
const allTodo: Todo[] = db.select().from(todos).all();
```

ìœ„ì™€ ê°™ì´ InferSelectModelì„ ì‚¬ìš©í•˜ê³  ê·¸ë¦¬ê³  allTodo ì„ ì–¸ì—ì„œ 'Todo[]'ë¼ê³  í™•ì‹¤í•˜ê²Œ Todoì˜ ë°°ì—´ì´ë¼ê³  ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 8. ì‹¤í–‰í•œ SQL ë‚´ìš© í™•ì¸í•˜ê¸°

Drizzleì„ ì´ìš©í•´ì„œ ì‹¤í–‰í•œ SQL ë‚´ìš©ì„ í™•ì¸í•´ ë³´ë ¤ë©´ toSQL ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```js
import { db } from './db/db'
import { todos } from './db/schema'

async function main() {
  const allTodo = db.select().from(todos).toSQL()
  console.log(allTodo)
}

main()
```

ìœ„ ì½”ë“œì²˜ëŸ¼ toSQL ë©”ì„œë“œëŠ” ì•„ë˜ì™€ ê°™ì´ ì‹¤ì œ SQL ë¬¸êµ¬ë¥¼ ë¦¬í„´ í•´ ì¤ë‹ˆë‹¤.

```bash
npx ts-node index.ts

{ sql: 'select "id", "name", "isCompleted" from "todos"', params: [] }
```

---

## 9. ë¡œê¹… ì„¤ì •

ë§¤ë²ˆ ì‹¤í–‰í•˜ëŠ” SQL ë¬¸êµ¬ì— ë¡œê¹…ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ë°ìš”.

db.ts íŒŒì¼ ì¤‘ ì¼ë¶€ë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ë©´ ë©ë‹ˆë‹¤.

```js
export const db: BetterSQLite3Database = drizzle(sqlite, { logger: true })
```

logger ì˜µì…˜ì„ í™œì„±í™”í•œ ê²ë‹ˆë‹¤.

```bash
npx ts-node index.ts

Query:
                        CREATE TABLE IF NOT EXISTS "__drizzle_migrations" (
                                id SERIAL PRIMARY KEY,
                                hash text NOT NULL,
                                created_at numeric
                        )

Query: SELECT id, hash, created_at FROM "__drizzle_migrations" ORDER BY created_at DESC LIMIT 1
Query: BEGIN
Query: COMMIT
{ sql: 'select "id", "name", "isCompleted" from "todos"', params: [] }
```

ìœ„ì²˜ëŸ¼ ë³µì¡í•œ Queryê°€ ë‚˜ì˜¤ëŠ”ë°ìš”.

ìš°ë¦¬ê°€ ëª¨ë¥´ëŠ” ì‚¬ì´ Drizzleì€ todos í…Œì´ë¸”ì˜ SQL ì´ì™¸ì—ë„ Queryë¥¼ ìˆ˜í–‰í•˜ê³  ìˆê³ , ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ê´€ë ¨ëœ í…Œì´ë¸”ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ê°€ ìˆ˜í–‰ ì¤‘ì¸ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

ì§€ê¸ˆê¹Œì§€ Drizzle ORMì— ëŒ€í•´ ì •ë§ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë´¤ëŠ”ë°ìš”.

ê¸°ì´ˆë§Œ ë°°ìš´ ê±°ë¡œ ìƒê°í•˜ì‹œê³  ê³µì‹ ë¬¸ì„œë¥¼ ì¢€ ë” ê¹Šê²Œ ì‚´í´ë³´ì‹œë©´ ì¢‹ì€ ê³µë¶€ê°€ ë  ê²ë‹ˆë‹¤.

ê·¸ëŸ¼.
