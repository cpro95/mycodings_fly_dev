---
slug: 2024-03-24-understanding-astro-db-with-making-todo-app
title: Astro DB ë§›ë³´ê¸° - Todo ì•± ë§Œë“¤ê¸°
date: 2024-03-24T01:15:09.640Z
description: Astro DB ë§›ë³´ê¸° - Todo ì•± ë§Œë“¤ê¸°
meta:
  keywords:
    - astrojs
    - astro db
published: true
---

# Astro DB ë§›ë³´ê¸° - Todo ì•± ë§Œë“¤ê¸°

ì•ˆë…•í•˜ì„¸ìš”?

ì˜¤ëŠ˜ì€ Astro DBë¥¼ ì‚´í´ë³¼ ì˜ˆì •ì¸ë°ìš”.

Todo ì•±ì„ ë§Œë“¤ì–´ ë³´ë©´ì„œ Astro DBì˜ ì‚¬ìš©ë²•ì„ ë§›ë³´ê¸°ë¡œ ì ê¹ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

** ëª© ì°¨ **

- [ìµœì‹  Astro í…œí”Œë¦¿ ì„¤ì¹˜](#ìµœì‹ -astro-í…œí”Œë¦¿-ì„¤ì¹˜)
- [Astro DB ì„¤ì¹˜](#astro-db-ì„¤ì¹˜)
- [Astro DB í…Œì´ë¸” ì •ì˜](#astro-db-í…Œì´ë¸”-ì •ì˜)
- [Astro DB Seed ë°ì´í„° ë§Œë“¤ê¸°](#astro-db-seed-ë°ì´í„°-ë§Œë“¤ê¸°)
- [ë Œë”ë§ì„ SSRë¡œ ë³€ê²½](#ë Œë”ë§ì„-ssrë¡œ-ë³€ê²½)
- [Astro DB ë°ì´í„°ë¥¼ í˜ì´ì§€ê²Œ í‘œì‹œí•˜ê¸°](#astro-db-ë°ì´í„°ë¥¼-í˜ì´ì§€ê²Œ-í‘œì‹œí•˜ê¸°)
- [Astro DBì— ë°ì´í„° ì¶”ê°€í•˜ê¸°](#astro-dbì—-ë°ì´í„°-ì¶”ê°€í•˜ê¸°)
- [Astro DBë¡œ ë°ì´í„° í¸ì§‘í•˜ê¸°](#astro-dbë¡œ-ë°ì´í„°-í¸ì§‘í•˜ê¸°)
- [Astro DBë¡œ ë°ì´í„° ì‚­ì œí•˜ê¸°](#astro-dbë¡œ-ë°ì´í„°-ì‚­ì œí•˜ê¸°)
- [Astro DBì˜ ì‹¤ì œ DB íŒŒì¼ì€ ì–´ë””ì—?](#astro-dbì˜-ì‹¤ì œ-db-íŒŒì¼ì€-ì–´ë””ì—)

---

## ìµœì‹  Astro í…œí”Œë¦¿ ì„¤ì¹˜

```bash
npm create astro@latest
Need to install the following packages:
  create-astro@4.7.5
Ok to proceed? (y)

 astro   Launch sequence initiated.

   dir   Where should we create your new project?
         ./astro-todo

  tmpl   How would you like to start your new project?
         Empty

    ts   Do you plan to write TypeScript?
         Yes

   use   How strict should TypeScript be?
         Strict

  deps   Install dependencies?
         Yes

   git   Initialize a new git repository?
         Yes

      âœ”  Project initialized!
         â–  Template copied
         â–  TypeScript customized
         â–  Dependencies installed
         â–  Git initialized

  next   Liftoff confirmed. Explore your project!

         Enter your project directory using cd ./astro-todo
         Run npm run dev to start the dev server. CTRL+C to stop.
         Add frameworks like react or tailwind using astro add.

         Stuck? Join us at https://astro.build/chat

â•­â”€â”€â”€â”€â”€â•®  Houston:
â”‚ â—  â—¡ â—   Good luck out there, astronaut! ğŸš€
â•°â”€â”€â”€â”€â”€â•¯
 ~/C/J/astro-test î‚° cd astro-todo
```

ì´ì œ ê°œë°œ ì„œë²„ë¥¼ ëŒë ¤ë´…ì‹œë‹¤.

í° ë¬¸ì œê°€ ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì €ì— "Astro" ê¸€ìê°€ í¬ê²Œ ì˜ ë³´ì¼ê²ë‹ˆë‹¤.

---

## Astro DB ì„¤ì¹˜

Astro DBë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´ í„°ë¯¸ë„ì—ì„œ ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.

```sh
npx astro add db
```

```sh
npx astro add db
âœ” Resolving packages...

  Astro will run the following command:
  If you skip this step, you can always run it yourself later

 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ npm install @astrojs/db@^0.9.4  â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

âœ” Continue? â€¦ yes
âœ” Installing dependencies...

  Astro will scaffold ./db/config.ts and ./db/seed.ts files.

âœ” Continue? â€¦ yes

  Astro will make the following changes to your config file:

 â•­ astro.config.mjs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ import { defineConfig } from 'astro/config';  â”‚
 â”‚                                               â”‚
 â”‚ import db from "@astrojs/db";                 â”‚
 â”‚                                               â”‚
 â”‚ // https://astro.build/config                 â”‚
 â”‚ export default defineConfig({                 â”‚
 â”‚   integrations: [db()]                        â”‚
 â”‚ });                                           â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

âœ” Continue? â€¦ yes

   success  Added the following integration to your project:
```

@astrojs/db íŒ¨í‚¤ì§€ë¥¼ ì¸ìŠ¤í†¨í•´ì£¼ê³  ìˆê³ , `db/config.ts` íŒŒì¼ê³¼ `db/seed.ts` íŒŒì¼ê¹Œì§€ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.

`astro.config.mjs` íŒŒì¼ì— db ê´€ë ¨ ì„¸íŒ…ê°’ë„ ë„£ì–´ì£¼ê³  ìˆë„¤ìš”.

---

## Astro DB í…Œì´ë¸” ì •ì˜

ì´ì œ `db/config.ts` íŒŒì¼ì„ ë¨¼ì € ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

ì´ íŒŒì¼ì—ì„œ í…Œì´ë¸”ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ë°ìš”.

```js
import { defineDb } from 'astro:db';

// https://astro.build/db/config
export default defineDb({
  tables: {}
});
```

ì´ˆê¸° ìƒíƒœëŠ” ìœ„ì™€ ê°™ì´ ë‚˜ì˜µë‹ˆë‹¤.

Sqlite DBëŠ” ì—¬ëŸ¬ê°œì˜ í…Œì´ë¸”ì„ ê°€ì§€ê³  ìˆëŠ”ë°ìš”.

Astro DBë„ sqliteì´ê¸° ë•Œë¬¸ì— í…Œì´ë¸”ì„ ê°€ì¥ ê¸°ë³¸ì ìœ¼ë¡œ ì„¸íŒ…í•´ì•¼ í•©ë‹ˆë‹¤.

ì˜¤ëŠ˜ ìš°ë¦¬ëŠ” Todo ì•±ì„ ë§Œë“¤ê¸°ë¡œ í–ˆìœ¼ë‹ˆê¹Œ ê°€ì¥ ê¸°ë³¸ì ì¸ ì»¬ëŸ¼ì„ ê°–ëŠ” Todos í…Œì´ë¸”ì„ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

`db/config.ts` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ì‹­ì‹œìš”.

```js
import { column, defineDb, defineTable } from 'astro:db';

const Todos = defineTable({
  columns: {
    id: column.number({ primaryKey: true }),
    name: column.text(),
    completed: column.boolean()
  }
})

// https://astro.build/db/config
export default defineDb({
  tables: {
    Todos
  }
});
```

Astro DBì—ì„œ í…Œì´ë¸”ì„ ì •ì˜í•˜ëŠ” í•¨ìˆ˜ëŠ” defineTableì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì»¬ëŸ¼ì„ ì •ì˜í•˜ëŠ” ë¶€ë¶„ë„ column í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ê³  ìˆëŠ”ë°ìš”.

ì•½ê°„ Zod ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³´ëŠ”ê²ƒ ê°™ë„¤ìš”.

ê°€ì¥ ê¸°ë³¸ì´ `id` ë¶€ë¶„ì¸ë°ìš”.

SQLì˜ ê¸°ë³¸ì¸ `primaryKey` ë¶€ë¶„ì„ ê¼­ ì„¤ì •í•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ `name`ê³¼ `completed` ë¶€ë¶„ì¸ë°ìš”.

ì›ë˜ SqliteëŠ” boolean íƒ€ì…ì„ ì§€ì›í•´ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

ìœ„ ì½”ë“œì—ì„œëŠ” `column.boolean()`ì™€ ê°™ì´ boolean íƒ€ì…ì„ ìì²´ì ìœ¼ë¡œ êµ¬í˜„í•´ì„œ ì§€ì›í•´ ì£¼ê³  ìˆë„¤ìš”.

---

## Astro DB Seed ë°ì´í„° ë§Œë“¤ê¸°

Astro DBê°€ ì²˜ìŒ ë§Œë“¤ì—ˆë˜ê²Œ `db/config.ts` íŒŒì¼ê³¼ í•¨ê»˜ `db/seed.ts` íŒŒì¼ì¸ë°ìš”.

`db/seed.ts` íŒŒì¼ì€ ì‹œë“œ ë°ì´í„°ë¼ê³  í•©ë‹ˆë‹¤.

```js
import { db } from 'astro:db';

// https://astro.build/db/seed
export default async function seed() {
	// TODO
}
```

ì™œëƒí•˜ë©´ DBì˜ í‹€ë§Œ ìˆì§€ ì•„ë¬´ ë°ì´í„°ë„ ì—†ìœ¼ë©´ Todo ì•±ì—ì„œ ì•„ë¬´ëŸ° ì‘ì—…ë„ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ì£ .

ê·¸ë˜ì„œ ì´ˆê¸° ê°’ì„ ì„¸íŒ…í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•˜ëŠ”ë°ìš”.

ì•±ì„ ë°°í¬í•  ë•Œ ê´€ë¦¬ì ì•„ì´ë””ë¥¼ ì„¤ì •í•˜ê±°ë‚˜ ê¸°íƒ€ ì¤‘ìš”í•œ ì¼ì„ í•  ìˆ˜ ìˆëŠ”ê²Œ `db/seed.ts`íŒŒì¼ì…ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì¡°ê¸ˆ ì‰¬ìš´ Todo ì•±ì´ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ Todo ê°’ì„ ëª‡ê°œ ë„£ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
import { db, Todos } from "astro:db";

// https://astro.build/db/seed
export default async function seed() {
  await db.insert(Todos).values([
    { id: 1, name: "ì²«ë²ˆì§¸ Todo", completed: false },
    { id: 2, name: "ë‘ë²ˆì§¸ Todo", completed: true },
  ]);
}
```

ì•„ì£¼ ê°„ë‹¨í•œ ê°’ë§Œ ë„£ì—ˆìŠµë‹ˆë‹¤.

ì´ì œ DB ì„¤ì •ì€ ëì´ë„¤ìš”.

---

## ë Œë”ë§ì„ SSRë¡œ ë³€ê²½

Todo ì•±ì€ ì¶”ê°€ ì‚­ì œ ê°™ì€ ê¸°ëŠ¥ì´ ìˆì–´ì•¼ í•˜ëŠ”ë°ìš”.

ê·¸ë˜ì„œ ì„œë²„ì¸¡ì˜ ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë Œë”ë§ì„ SSRë¡œ ë³€ê²½í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

ì¦‰, SSRë¡œ ë³€ê²½í•˜ë©´ Nodejsê°€ ì²˜ë¦¬í•´ ì¤€ë‹¤ëŠ” ì–˜ê¸°ì…ë‹ˆë‹¤.

í˜„ì¬ Astro ì•±ì„ SSRë¡œ ë³€ê²½í•˜ëŠ” ë°©ë²•ì€ `astro.config.mjs` íŒŒì¼ì—ì„œ `output` ë¶€ë¶„ì„ `server`ë¡œ ë³€ê²½í•˜ë©´ ë©ë‹ˆë‹¤.

```js
import { defineConfig } from 'astro/config';

import db from "@astrojs/db";

// https://astro.build/config
export default defineConfig({
  integrations: [db()],
  output: 'server',
});
```

ì´ì œ ì„¤ì •ì´ ëª¨ë‘ ëë‚¬ë„¤ìš”.

---

## Astro DB ë°ì´í„°ë¥¼ í˜ì´ì§€ê²Œ í‘œì‹œí•˜ê¸°

Astroì˜ index í˜ì´ì§€ëŠ” ë°”ë¡œ `src/pages/index.astro` íŒŒì¼ì¸ë°ìš”.

ì´ íŒŒì¼ì„ ë³€ê²½í•´ì„œ Astro DB ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œí•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
---
import { db, Todos } from "astro:db";
const todos = await db.select().from(Todos);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
  </head>
  <body>
    <h1>Astro</h1>
    <ul>
      {
        todos.map(({ name, completed }) => (
          <li>
            <input type="checkbox" checked={completed} />
            {name}
          </li>
        ))
      }
    </ul>
  </body>
</html>
```

ì •ë§ ê°„ë‹¨í•˜ê²Œ DBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„¤ìš”.

ì•½ê°„ Drizzle ORMê³¼ ë¹„ìŠ·í•œ ë¶€ë¶„ì´ ë§ìŠµë‹ˆë‹¤.

ì™œëƒí•˜ë©´ Astro DBì•ˆì— ë¹ŒíŠ¸ì¸ìœ¼ë¡œ Drizzle ORMì˜ í´ë¼ì´ì–¸íŠ¸ê°€ ë“¤ì–´ê°€ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³¼ê¹Œìš”?

![](https://blogger.googleusercontent.com/img/a/AVvXsEg-JxsiLOLLd1EZN_L-7wLArV0jYuWxNJhU0sSKCmOlkAF1--8dmVzBvRO9waQTh_aPS6xxrJTjACSyEVxaExGaITf9rWVW3GwEwSR8Nmy6zUPF33QCLdcbfKxjbLtUW9tkNPg01tmQGzeSSVzO19G9SNXnl38T0EkANqcsGiE7AQVtNVXdhtA2v05nc_w)

ì•„ì£¼ ì˜ ì‘ë™ë˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## Astro DBì— ë°ì´í„° ì¶”ê°€í•˜ê¸°

ì´ì œ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•´ ë³¼ê¹Œìš”?

ë¨¼ì €, Astroê°€ ì œê³µí•˜ëŠ” API ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬í˜„í•´ì„œ ì‚¬ìš©ìì˜ Formì„ ì²˜ë¦¬í•˜ê²Œ í•  ì‘ì •ì…ë‹ˆë‹¤.

API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì€ íŒŒì¼ë¡œ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

`src/pages/api/todos/index.ts` íŒŒì¼ì…ë‹ˆë‹¤.

```js
import type { APIRoute } from "astro";
import { db, Todos } from "astro:db";

export const POST: APIRoute = async ({ request, redirect }) => {
  const formData = await request.formData();
  const name = formData.get("name");
  if (typeof name === "string") {
    await db.insert(Todos).values({ name, completed: false });
  }

  return redirect("/");
};
```

API ë¡œì§ì€ ì•„ì£¼ ê°„ë‹¨í•©ë‹ˆë‹¤.

formDataì—ì„œ 'name' ë¶€ë¶„ì„ ê°€ì ¸ì˜¤ê³  ê·¸ê²Œ 'string' íƒ€ì…ì´ë©´ DBì— ì¶”ê°€í•˜ëŠ” ê²ë‹ˆë‹¤.

`db.insert(Todos).values()` ê°™ì€ í˜•ì‹ìœ¼ë¡œ insertë¥¼ í•˜ë©´ ë©ë‹ˆë‹¤.

 Drizzle ORM clientê°€ ë“¤ì–´ê°€ ìˆì–´ ì €ëŠ” ì´í•´í•˜ê¸°ê°€ ì•„ì£¼ ì‰¬ìš´ë°ìš”.

ì œê°€ ì˜ˆì „ì— ê°•ì˜í•œ Drizzle ORM ê¸€ì€ ì•„ë˜ ë§í¬ì— ìˆìœ¼ë‹ˆ ê¼­ í•œ ë²ˆ ì½ì–´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.

[Drizzle ORM ì‰½ê²Œ ì´í•´í•˜ê¸°](https://mycodings.fly.dev/blog/2023-12-09-quick-understanding-of-drizzle-orm)

ì´ì œ API ë¡œì§ì„ ì™„ì„±í–ˆìœ¼ë‹ˆê¹Œ Form UIë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¹ì—°íˆ `src/pages/index.astro` íŒŒì¼ ì•„ë˜ ë¶€ë¶„ì— ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

```js
---
import { db, Todos } from "astro:db";
const todos = await db.select().from(Todos);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
  </head>
  <body>
    <h1>Astro</h1>
    <ul>
      {
        todos.map(({ name, completed }) => (
          <li>
            <input type="checkbox" checked={completed} />
            {name}
          </li>
        ))
      }
    </ul>

    <form method="POST" action="/api/todos">
      <label>Todo
        <input name="name" />
      </label>
      <button>ì¶”ê°€</button>
    </form>
  </body>
</html>
```

ì‹¤í–‰ê²°ê³¼ë¥¼ ë³¼ê¹Œìš”?

![](https://blogger.googleusercontent.com/img/a/AVvXsEiP4ZdoVYt_uunxcSta2P3mhtWtqTqSHPBIYP79ImBt1_jpXQBhhy6FWm5_2ds_mbg-qXY5EydTgFFynKj-M4kRL3Pk4fVTIC6p1gYE25USxi7mnXVQFeHHoTSC55CnPaPh82ybJ2thenrwkE-oWt7jeuGD7DTNBeoU0BqmNcIsOriSmM--G6gHmMMP4To)

ìœ„ì™€ ê°™ì´ Todos ì¶”ê°€í•˜ê¸°ê°€ ì•„ì£¼ ì˜ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## Astro DBë¡œ ë°ì´í„° í¸ì§‘í•˜ê¸°

ì§€ê¸ˆê¹Œì§€ ë§Œë“  ì•±ì€ ì¶”ê°€í•˜ê¸°ê¹Œì§€ëŠ” ì™„ë²½í•˜ê²Œ ì‘ë™í•˜ëŠ”ë°ìš”.

ì²´í¬ë°•ìŠ¤ë¥¼ ëˆ„ë¥´ë©´ ì•„ë¬´ ë³€í™”ë„ ì—†ìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì´ì œ ì¶”ê°€í•˜ê¸°ê°€ ëë‚¬ìœ¼ë‹ˆ í¸ì§‘í•˜ê¸° ì¦‰, Update ë¶€ë¶„ì„ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.

UIë¶€ë¶„ì—ì„œ input checkbox ë¶€ë¶„ì— ë§Œì•½ í´ë¦­ì‹œ í•´ë‹¹ Todosì˜ idë¥¼ formìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
<ul>
    {
    todos.map(({ id, name, completed }) => (
        <li>
        <form method="POST" action={`/api/todos/${id}`}>
            <input type="checkbox" checked={completed} name="completed" />
            {name}
            <button>ë³€ê²½</button>
        </form>
        </li>
    ))
    }
</ul>
```

ë³´í†µ React ì½”ë“œì—ì„œëŠ” onClick, onChange ê°™ì€ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë Œë”ë§ ë¡œì§ì„ ë§ì´ ì‚¬ìš©í•˜ëŠ”ë°ìš”.

ìš°ë¦¬ê°€ í•˜ëŠ” Todos ì•±ì€ ì„œë²„ì‚¬ì´ë“œë Œë”ë§ì…ë‹ˆë‹¤.

ì„œë²„ì‚¬ì´ë“œë Œë”ë§ì€ formì„ ì „ì†¡í•˜ê³  ì „ì†¡ëœ í¼ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ë‹¤ì‹œ UIë¥¼ ê·¸ë ¤ì£¼ëŠ” ë¡œì§ìœ¼ë¡œ ì‘ì„±ë©ë‹ˆë‹¤.

ê·¸ë˜ì„œ ìœ„ì™€ ê°™ì´ input ë°•ìŠ¤ì˜ checkboxë¥¼ í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ formì´ ì‘ë™í•˜ê²Œ ë©ë‹ˆë‹¤.

ë³€ê²½ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³¼ê¹Œìš”?

![](https://blogger.googleusercontent.com/img/a/AVvXsEhKdLLPXuWWjR0Ak0q1xBoNIJD5PQxSGZH3f5TdcYKOnvMlxnxcj1ntMYd_Ar9Y_XSESmw0LuiJ_O8Va8pb2Fh7UbOA7FjDO5jNa5VniNQh1ovEsc7W2ECoFGAlqW217-4fsIaAaEXAXk5TY6Nt4v7pc3QQTM-FU0DOU-caX1-F8k6xRX30GSKXFl5X8gk)

ìœ„ì™€ ê°™ì´ ì—ëŸ¬ê°€ ë‚˜ì˜µë‹ˆë‹¤. 

ì•„ì§ í•´ë‹¹ API ì—”ë“œí¬ì¸íŠ¸ëŠ” ì‘ì„±ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì¸ë°ìš”.

API ì—”ë“œí¬ì¸íŠ¸ëŠ” `api/todos/{id}` ì¸ë°ìš”.

ë‹¤ì´ë‚´ë¯¹ ë¼ìš°íŒ…ì´ë„¤ìš”.

ì´ê±¸ êµ¬í˜„í•´ ë³´ê² ìŠµë‹ˆë‹¤.

Astroì—ì„œì˜ ë‹¤ì´ë‚´ë¯¹ ë¼ìš°íŒ…ì€ `[]`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

`src/pages/api/todos/[id].ts` íŒŒì¼ì„ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

```js
import type { APIRoute } from "astro";
import { db, Todos, eq } from "astro:db";

export const POST: APIRoute = async ({ params, request, redirect }) => {
  const formData = await request.formData();
  const completed = formData.get("completed");

  await db
    .update(Todos)
    .set({ completed: completed === "on" })
    .where(eq(Todos.id, Number(params.id)));

  return redirect("/");
};
```

ì´ì œ ì™„ì„±ì´ ë˜ì—ˆë„¤ìš”.

ì´ì œ ì²´í¬ë°•ìŠ¤ë¥¼ ë³€ê²½í•´ ë´…ì‹œë‹¤.

ë³€ê²½ì€ ì˜ ë˜ëŠ”ë°ìš”.

ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ê³  'ë³€ê²½' ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼í•˜ëŠ”ê²Œ ì¡°ê¸ˆì€ ë²ˆê±°ë¡œìš´ë°ìš”.

Reactì˜ ê²½ìš° ì ˆëŒ€ ì´ë ‡ê²Œ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ê·¸ëŸ¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¡œ onChange ë¡œì§ì„ êµ¬í˜„í•´ ë³¼ê¹Œìš”?

`src/pages/index.astro` íŒŒì¼ì—ì„œ `<script>`íƒœê·¸ë¥¼ ì¶”ê°€í•´ì„œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì‘ë™ë˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ `body` íƒœê·¸ê°€ ëë‚˜ëŠ” ì•ìª½ì— `script` íƒœê·¸ë¥¼ ë„£ì–´ë‘ê³ ìš”.

ì´ì œ 'ë³€ê²½' ë²„íŠ¼ì€ ì§€ì›Œë„ ë©ë‹ˆë‹¤.

```js
    <li>
        <form method="POST" action={`/api/todos/${id}`}>
            <input type="checkbox" checked={completed} name="completed" />
            {name}
        </form>
    </li>

    ...
    ...
    ìƒëµ
    ...
    ...

    <script>
        const updateTriggers = document.querySelectorAll(
        "input[type='checkbox']"
        );
        updateTriggers.forEach((trigger) => {
        trigger.addEventListener("change", (e) => {
            const currentTarget = e.currentTarget as HTMLInputElement;
            const targetForm = currentTarget.parentElement as HTMLFormElement;
            targetForm.submit();
        });
        });
    </script>
</body>
```

ì´ì œ í…ŒìŠ¤íŠ¸í•´ë³´ì‹­ì‹œìš”.

ì²´í¬ë°•ìŠ¤ë¥¼ ëˆ„ë¥¼ë•Œë§ˆë‹¤ DBê°€ ì‘ë™í•˜ê²Œ ë ê²ë‹ˆë‹¤.

ë„ˆë¬´ ë¹¨ë¼ ë³´ì´ì§€ ì•Šì„ ê²½ìš° ì²´í¬ë°•ìŠ¤ í•œë²ˆ ëˆ„ë¥´ê³  ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê·¸ ì°¨ì´ë¥¼ ì´í•´í•  ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

---

## Astro DBë¡œ ë°ì´í„° ì‚­ì œí•˜ê¸°

ì´ì œ Delete ë¡œì§ì„ êµ¬í˜„í•´ ë´…ì‹œë‹¤.

ë¡œì§ êµ¬í˜„ì„ ì‰½ê²Œí•˜ê¸° ìœ„í•´ ìš°ë¦¬ê°€ ì•„ê¹Œ ë§Œë“¤ì—ˆë˜ `src/pages/api/todos/[id].ts`íŒŒì¼ì„ ì¡°ê¸ˆ ìˆ˜ì €í•˜ê² ìŠµë‹ˆë‹¤.

`src/pages/api/todos/[id].ts` íŒŒì¼ì—ëŠ” POST ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì´ ìˆëŠ”ë°ìš”.

ì—¬ê¸°ì— GET ìš”ì²­ì´ ì˜¤ë©´ í•´ë‹¹ idë¥¼ ì‚­ì œí•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

ì›ë˜ëŠ” `src/pages/api/todos/delete/[id].ts` ê°™ì€ ê±¸ ë§Œë“¤ì–´ì•¼ ê² ì£ .

ì €ëŠ” ë³„ë¡œ í° ì•±ë„ ì•„ë‹ˆë‹ˆê¹Œ ê°„ë‹¨í•œ GET ìš”ì²­ ì¦‰, `<a>` ì•µì»¤ë§Œìœ¼ë¡œë„ ì‚­ì œí•˜ê²Œë” ë¡œì§ì„ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤.

ë¨¼ì €, UIë¥¼ ì—…ë°ì´íŠ¸ í•˜ê² ìŠµë‹ˆë‹¤.

```js
<form method="POST" action={`/api/todos/${id}`}>
    <input type="checkbox" checked={completed} name="completed" />
    {name}
    <a href={`/api/todos/${id}`}>ì‚­ì œ</a>
</form>
```

ìœ„ì™€ ê°™ì´ `<a>` íƒœê·¸ë¡œ GET ìš”ì²­ì„ ë³´ë‚´ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
 
ì´ì œ `src/pages/api/todos/delete/[id].ts` íŒŒì¼ì— GET ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

```js
export const GET: APIRoute = async ({ params, redirect }) => {
  await db.delete(Todos).where(eq(Todos.id, Number(params.id)));
  return redirect("/");
};
```

ìœ„ì™€ ê°™ì´ ì•„ì£¼ ì‰¬ìš´ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ì œ í…ŒìŠ¤íŠ¸í•´ ë³¼ê¹Œìš”?

ì‚­ì œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì˜ ì‘ë™ë ê²ë‹ˆë‹¤.

ì´ì œ ì™„ì„±ë˜ì—ˆë„¤ìš”.

---

## Astro DBì˜ ì‹¤ì œ DB íŒŒì¼ì€ ì–´ë””ì—?

ì†Œì œëª© ê°™ì€ ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆëŠ”ë°ìš”.

`.astro` í´ë” ë°‘ì— ë³´ë©´ `content.db` íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤.

ì´ íŒŒì¼ì„ ì—´ì–´ë³´ë©´ ìš°ë¦¬ê°€ ë§Œë“  Todos í…Œì´ë¸”ì´ ë³´ì¼ê²ë‹ˆë‹¤.

```sh
sqlite3 content.db                      ì¼  3/24 10:09:00 2024
SQLite version 3.43.2 2023-10-10 13:08:14
Enter ".help" for usage hints.
sqlite> .schema
CREATE TABLE IF NOT EXISTS "Todos" ("id" integer PRIMARY KEY, "name" text NOT NULL, "completed" integer NOT NULL);
sqlite> sqlite> select Todos;
1|ì²«ë²ˆì§¸ Todo|0
2|ë‘ë²ˆì§¸ Todo|1
sqlite> .exit
```

ê·¸ë¦¬ê³  `.astro` í´ë”ì— ë³´ì‹œë©´ `db-types.d.ts` íŒŒì¼ë„ ë³´ì´ì‹¤ ê±´ë°ìš”.

```sh
// This file is generated by Astro DB
declare module 'astro:db' {
	export const Todos: import("@astrojs/db/runtime").Table<
		"Todos",
		{"id":{"type":"number","schema":{"unique":false,"deprecated":false,"name":"id","collection":"Todos","primaryKey":true}},"name":{"type":"text","schema":{"unique":false,"deprecated":false,"name":"name","collection":"Todos","primaryKey":false,"optional":false}},"completed":{"type":"boolean","schema":{"optional":false,"unique":false,"deprecated":false,"name":"completed","collection":"Todos"}}}
	>;
}
```

ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ í…Œì´ë¸”ì— ëŒ€í•œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íƒ€ì…ë„ ì˜ ì§€ì •í•´ ì£¼ê³  ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¼.


