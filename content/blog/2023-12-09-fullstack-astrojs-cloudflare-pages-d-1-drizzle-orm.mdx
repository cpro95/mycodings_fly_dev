---
slug: 2023-12-09-fullstack-astrojs-cloudflare-pages-d-1-drizzle-orm
title: í’€ìŠ¤íƒ ê°•ì˜ 3í¸. AstroJSì™€ Cloudflare Pages, D1, Drizzle ORMìœ¼ë¡œ ê°œë°œí•˜ê¸°
date: 2023-12-09T12:39:43.046Z
description: í’€ìŠ¤íƒ ê°œë°œí•˜ê¸° AstroJS + Cloudflare pages + D1 + Drizzle ORM
meta:
  keywords:
    - astrojs
    - pages
    - d1
    - drizzle
    - cloudflare
published: true
---

# í’€ìŠ¤íƒ ê°•ì˜ 3í¸. AstroJSì™€ Cloudflare Pages, D1, Drizzle ORMìœ¼ë¡œ ê°œë°œí•˜ê¸°

ì•ˆë…•í•˜ì„¸ìš”?

ì´ë²ˆ ì‹œê°„ì—ë„ í’€ìŠ¤íƒ ê°•ì˜ì¸ë°ìš”.

Cloudflare ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•œ ê°•ì˜ì¸ë° AstroJSë¥¼ ì´ìš©í•œ ë°©ì‹ì…ë‹ˆë‹¤.

ì§€ë‚œ ì‹œê°„ì—ëŠ” Reactì™€ í•¨ê»˜ Cloudflare Pages, Workers, D1ì„ ì´ìš©í–ˆì—ˆëŠ”ë°ìš”.

ì˜¤ëŠ˜ì€ D1 DBë¥¼ ì¢€ ë” í¸í•˜ê²Œ ë‹¤ë£¨ê¸° ìœ„í•œ Dirzzle ORMì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

ì „ì²´ ê°•ì˜ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.

1. [í’€ìŠ¤íƒ ê°•ì˜ 1í¸. Cloudflare Pages + Workers + D1 + Reactë¡œ í’€ìŠ¤íƒ ê°œë°œí•˜ê¸°](https://mycodings.fly.dev/blog/2023-12-06-introduction-cloudflare-pages-workers-d-1-react-full-stack)

2. [í’€ìŠ¤íƒ ê°•ì˜ 2í¸. Cloudflare Pages ì•ˆì—ì„œ Workersë¥¼ ì´ìš©í•œ D1 DB ì œì–´í•˜ëŠ” API ë§Œë“¤ê¸°](https://mycodings.fly.dev/blog/2023-12-09-fullstack-cloudflare-pages-workers-d-1-react-part-2)

3. [í’€ìŠ¤íƒ ê°•ì˜ 3í¸. AstroJSì™€ Cloudflare Pages, D1, Drizzle ORMìœ¼ë¡œ ê°œë°œí•˜ê¸°](https://mycodings.fly.dev/blog/2023-12-09-fullstack-astrojs-cloudflare-pages-d-1-drizzle-orm)

4. [í’€ìŠ¤íƒ ê°•ì˜ 4í¸. Remix + Cloudflare Pages + D1 DB + Drizzle ORM](https://mycodings.fly.dev/blog/2023-12-10-fullstack-remix-cloudflare-pages-d-1-db-drizzle-orm)

5. [í’€ìŠ¤íƒ ê°•ì˜ 5í¸. Next.js ì„œë²„ ë Œë”ë§ì„ ì´ìš©í•˜ì—¬ Cloudflare Pagesë¡œ ë°°í¬í•˜ê¸°(D1 DB, Drizzle ORM)](https://mycodings.fly.dev/blog/2023-12-30-fullstack-tutorial-nextjs-cloudflare-with-d-1-db)

---

** ëª© ì°¨ **

1. [AstroJS í…œí”Œë¦¿ ì„¤ì¹˜í•˜ê¸°](#1-astrojs-í…œí”Œë¦¿-ì„¤ì¹˜í•˜ê¸°)

2. [D1 DB ì„¤ì •í•˜ê¸°](#2-d1-db-ì„¤ì •í•˜ê¸°)

3. [Drizzle ORM ì„¤ì •í•˜ê¸°](#3-drizzle-orm-ì„¤ì •í•˜ê¸°)

4. [Wrangler ë¡œì»¬ í™˜ê²½ì— Sqlite DB ë§Œë“¤ê¸°](#4-wrangler-ë¡œì»¬-í™˜ê²½ì—-sqlite-db-ë§Œë“¤ê¸°)

5. [ë¡œì»¬ DBì— ë”ë¯¸ ë°ì´í„° ë„£ê¸°](#5-ë¡œì»¬-dbì—-ë”ë¯¸-ë°ì´í„°-ë„£ê¸°)

6. [AstroJSì™€ Drizzleì„ ì—°ê²°í•˜ê¸° ìœ„í•œ Env êµ¬ì¶•](#6-astrojsì™€-drizzleì„-ì—°ê²°í•˜ê¸°-ìœ„í•œ-env-êµ¬ì¶•)

7. [End Pointë¡œ POST ë©”ì„œë“œ ëŒ€ì‘í•˜ê¸°](#7-end-pointë¡œ-post-ë©”ì„œë“œ-ëŒ€ì‘í•˜ê¸°)

8. [EDGE ì„œë²„ì— ì˜¬ë¦¬ê¸°](#8-edge-ì„œë²„ì—-ì˜¬ë¦¬ê¸°)

---

## 1. AstroJS í…œí”Œë¦¿ ì„¤ì¹˜í•˜ê¸°

ì¼ë‹¨ astro í…œí”Œë¦¿ì„ ì„¤ì¹˜í•˜ê³  ê·¸ë‹¤ìŒì— cloudflare D1, Drizzle ORMì„ ì„¤ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.

```bash
npm create astro@latest --  --template=minimal --yes --skip-houston astro-pages-d1-example

cd astro-pages-d1-example

npx astro add cloudflare tailwind

Astro will make the following changes to your config file:

 â•­ astro.config.mjs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ import { defineConfig } from 'astro/config';   â”‚
 â”‚                                                â”‚
 â”‚ import cloudflare from "@astrojs/cloudflare";  â”‚
 â”‚ import tailwind from "@astrojs/tailwind";      â”‚
 â”‚                                                â”‚
 â”‚ // https://astro.build/config                  â”‚
 â”‚ export default defineConfig({                  â”‚
 â”‚   output: "server",                            â”‚
 â”‚   adapter: cloudflare(),                       â”‚
 â”‚   integrations: [tailwind()]                   â”‚
 â”‚ });                                            â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

astro.config.mjs íŒŒì¼ì— defineConfig ë¶€ë¶„ì„ ì•Œì•„ì„œ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.

cloudflareì— ë°°í¬í•˜ëŠ” ë°©ì‹ì€ SSR(Server Side Rendering) ë°©ì‹ì´ê³ ìš”.

tailwindë„ ì•Œì•„ì„œ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.

ì´ì œ wranglerì™€ Drizzle ORM ê´€ë ¨ íŒ¨í‚¤ì§€ë§Œ ì„¤ì¹˜í•˜ë©´ ë©ë‹ˆë‹¤.

```bash
npm i wrangler drizzle-orm better-sqlite3 @astrojs/check typescript

npm i -D @types/better-sqlite3 drizzle-kit
```

ì§€ê¸ˆê¹Œì§€ ì„¤ì¹˜ëœ package.json íŒŒì¼ ë‚´ì—­ì…ë‹ˆë‹¤.

```json
{
  "name": "astro-pages-d1-example",
  "type": "module",
  "version": "0.0.1",
  "scripts": {
    "dev": "astro dev",
    "start": "astro dev",
    "build": "astro check && astro build",
    "preview": "astro preview",
    "astro": "astro"
  },
  "dependencies": {
    "@astrojs/check": "^0.3.1",
    "@astrojs/cloudflare": "^8.0.0",
    "@astrojs/tailwind": "^5.0.3",
    "astro": "^4.0.3",
    "better-sqlite3": "^9.2.2",
    "drizzle-orm": "^0.29.1",
    "tailwindcss": "^3.3.6",
    "typescript": "^5.3.3",
    "wrangler": "^3.19.0"
  },
  "devDependencies": {
    "@types/better-sqlite3": "^7.6.8",
    "drizzle-kit": "^0.20.6"
  }
}
```

---

## 2. D1 DB ì„¤ì •í•˜ê¸°

ì´ì œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  D1 DBë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.

```bash
npx wrangler login

npx wrangler d1 create astro-db

âœ… Successfully created DB 'astro-db' in region APAC
Created your database using D1's new storage backend. The new storage backend is not yet recommended
for production workloads, but backs up your data via point-in-time restore.

[[d1_databases]]
binding = "DB" # i.e. available in your Worker on env.DB
database_name = "astro-db"
database_id = "7sadfsadf1be7e-42f8-4c27-98330-b675asdfsdaf37f54260"
```

Cloudflareì˜ ëŒ€ì‹œë³´ë“œë¡œ ë“¤ì–´ê°€ì„œ D1 ì„¹ì…˜ìœ¼ë¡œ ê°€ë©´ ì•„ë˜ì™€ ê°™ì´ 'astro-db'ë¼ëŠ” ì´ë¦„ì˜ D1 DBê°€ ìƒì„±ë˜ì–´ ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEjzNRXvDAIg7whzudvI13OclDOeunVZZ7xjl0AuqLBbzFs_pspU3SwNvWqpH0k_PzMV5cG4r1pHBs85jm5duIdVVOus8Pp7s6Yb3i0S1HmT4F5L6ylRAkB_MLM27YzUV4T-RO5dumt0Q1XJcfYaRfnz9eIFza5wTzu4EhuY6LQAQaZSpk4ngTsfFfo5Naw)

ì´ì œ wrangler.toml íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

```toml
name = "astro-pages-d1-example"
main = "./dist/_worker.js"
compatibility_date = "2023-12-09"

[[d1_databases]]
binding = "DB" # i.e. available in your Worker on env.DB
database_name = "astro-db"
database_id = "7sadfsadf1be7e-42f8-4c27-98330-b675asdfsdaf37f54260"
```

ìœ„ì™€ ê°™ì´ ë§Œë“¤ì—ˆëŠ”ë°ìš”.

main ë¶€ë¶„ì€ Cloudflare Worker ë°©ì‹ì¼ ê²½ìš° ì²˜ìŒ ì‹œì‘ë˜ëŠ” ì—”íŠ¸ë¦¬ íŒŒì¼ì…ë‹ˆë‹¤.

AstroJSê°€ Cloudflare Pagesì— SSR ë°©ì‹ìœ¼ë¡œ ë°°í¬ë˜ëŠ” ë°©ë²•ì€ ë°”ë¡œ Workersë¥¼ ì´ìš©í•œ ë°©ë²•ì¸ë°ìš”.

AstroJSê°€ ë¹Œë“œë˜ë©´ ì „ì²´ í”„ë¡œì íŠ¸ê°€ \_worker.js íŒŒì¼ë¡œ ì»´íŒŒì¼ë©ë‹ˆë‹¤.

ë‹¨ìˆœíˆ CloudflareëŠ” í•´ë‹¹ íŒŒì¼ì„ ì›¹ ì„œë¹™í•˜ëŠ” ë°©ì‹ì´ì£ .

ê·¸ë¦¬ê³  compatibility_dateëŠ” í˜„ì¬ ë‚ ì§œë¡œ ë„£ìœ¼ì‹œê³  ë§Œì•½ í™”ë©´ì— ë‹¤ë¥¸ ë‚ ì§œê°€ ë‚˜ì˜¤ë©´ ê·¸ ë‚ ì§œë¡œ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.

---

## 3. Drizzle ORM ì„¤ì •í•˜ê¸°

ì´ì œ DBë¥¼ ì¢€ ë” í¸ì•ˆí•˜ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ Drizzle ORMì„ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

src í´ë” ë°‘ì— db í´ë”ë¥¼ ë§Œë“¤ê³  ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ ì¤ë‹ˆë‹¤.

```js
import { integer, text, sqliteTable } from 'drizzle-orm/sqlite-core'

export const todos = sqliteTable('todos', {
  id: integer('id', { mode: 'number' }).primaryKey({ autoIncrement: true }),
  name: text('name'),
  isCompleted: integer('isCompleted', { mode: 'boolean' })
    .notNull()
    .default(false),
})
```

ì§€ë‚œ ì‹œê°„ì— ë°°ìš´ [Drizzle ORM ê°•ì˜í¸](https://mycodings.fly.dev/blog/2023-12-09-quick-understanding-of-drizzle-orm)ì— ë‚˜ì™”ë˜ todos ìŠ¤í‚¤ë§ˆ íŒŒì¼ì…ë‹ˆë‹¤.

ì´ì œ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ë§Œë“¤ì—ˆìœ¼ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ê² ì£ .

```bash
npx drizzle-kit generate:sqlite --schema=./src/db/schema.ts

drizzle-kit: v0.20.6
drizzle-orm: v0.29.1

1 tables
todos 3 columns 0 indexes 0 fks

[âœ“] Your SQL migration file âœ drizzle/0000_stormy_scarlet_witch.sql ğŸš€
```

ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ drizzle í´ë” ë°‘ì— ìˆëŠ” '0000_stormy_scarlet_witch.sql' íŒŒì¼ì´ë„¤ìš”.

ì´ íŒŒì¼ì˜ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```sql
CREATE TABLE `todos` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` text,
	`isCompleted` integer DEFAULT false NOT NULL
);
```

ì—­ì‹œë‚˜ ì˜ë„í–ˆë˜ ë°ë¡œ ë˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## 4. Wrangler ë¡œì»¬ í™˜ê²½ì— Sqlite DB ë§Œë“¤ê¸°

ìš°ë¦¬ê°€ Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ê¹Œì§€ ë§Œë“¤ì—ˆëŠ”ë°ìš”.

ì´ê±¸ Wrangler ë¡œì»¬ í™˜ê²½ì— ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

'--local' ì˜µì…˜ì„ ì´ìš©í•œë‹¤ëŠ” ì–˜ê¸°ì£ .

ì•„ì§ Cloudflare ì—£ì§€ ì„œë²„ì—ëŠ” ì˜¬ë¦¬ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¡œì»¬ í™˜ê²½ì—ì„œ DB êµ¬ì¶•ì„ í•œë‹¤ëŠ” ì–˜ê¸°ì…ë‹ˆë‹¤.

ì•„ê¹Œ Drizzleì´ ë§Œë“  sql íŒŒì¼ì´ë¦„ì´ ë°”ë¡œ '0000_stormy_scarlet_witch.sql'ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì•„ë˜ ëª…ë ¹ì–´ì— í•´ë‹¹ íŒŒì¼ì´ë¦„ì„ ì˜ ì ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.

```bash
npx wrangler d1 execute astro-db --local --file=./drizzle/0000_stormy_scarlet_witch.sql
ğŸŒ€ Mapping SQL input into an array of statements
ğŸŒ€ Executing on local database astro-db (1143731be7e-412348-4237-98230-b623235260) from .wrangler/state/v3/d1:
```

ì‹¤ì œ íŒŒì¼ì´ ìˆëŠ” ê³³ìœ¼ë¡œ ê°€ì„œ í™•ì¸í•´ ë³¼ê¹Œìš”?

```bash
cd .wrangler/state/v3/d1/miniflare-D1DatabaseObject

sqlite3 55d4cd3f70b771065dcf633d2888b1ec2dad2eebd6026a91cf0dda1325006021.sqlite

SQLite version 3.37.0 2021-12-09 01:34:53
Enter ".help" for usage hints.
sqlite> .schema
CREATE TABLE _cf_KV (
      key TEXT PRIMARY KEY,
      value BLOB
    ) WITHOUT ROWID;
CREATE TABLE `todos` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` text,
	`isCompleted` integer DEFAULT false NOT NULL
);
CREATE TABLE sqlite_sequence(name,seq);
sqlite> select * from todos;
sqlite>
```

ì—­ì‹œë‚˜ todos í…Œì´ë¸”ì´ ì˜ ì„¤ì •ë˜ì—ˆë„¤ìš”.

---

## 5. ë¡œì»¬ DBì— ë”ë¯¸ ë°ì´í„° ë„£ê¸°

í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ todos í…Œì´ë¸”ì— ë”ë¯¸ ë°ì´í„°ë¥¼ ë„£ì–´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```bash
npx wrangler d1 execute astro-db --local --command="insert into todos (name, isCompleted) values ('test 1', 0);"

ğŸŒ€ Mapping SQL input into an array of statements
ğŸŒ€ Executing on local database astro-db (1143731be7e-412348-4237-98230-b623235260) from .wrangler/state/v3/d1:
```

ì˜ ë˜ê³  ìˆë„¤ìš”.

ëª‡ê°œ ë” ë„£ì–´ë³´ì„¸ìš”.

ë§ì´ ë„£ì—ˆìœ¼ë©´ select ë¬¸ìœ¼ë¡œ í™•ì¸í•´ ë³¼ê¹Œìš”?

```bash
npx wrangler d1 execute astro-db --local --command="select * from todos;"

ğŸŒ€ Mapping SQL input into an array of statements
ğŸŒ€ Executing on local database astro-db (1143731be7e-412348-4237-98230-b623235260) from .wrangler/state/v3/d1:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name   â”‚ isCompleted â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ test 1 â”‚ 0           â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2  â”‚ test 2 â”‚ 1           â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3  â”‚ test 3 â”‚ 0           â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4  â”‚ test 4 â”‚ 1           â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5  â”‚ test 5 â”‚ 0           â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ì´ 5ê°œì˜ ë”ë¯¸ ë°ì´í„°ê°€ ì˜ ë“¤ì–´ê°€ ìˆë„¤ìš”.

---

## 6. AstroJSì™€ Drizzleì„ ì—°ê²°í•˜ê¸° ìœ„í•œ Env êµ¬ì¶•

ì—¬ê¸°ê°€ ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì¸ë°ìš”.

êµ¬ê¸€ë§ì„ ëª‡ ë²ˆì— ê±¸ì³ ì°¾ì•„ë³´ì•„ë„ ìë£Œê°€ ë³„ë¡œ ì—†ìŠµë‹ˆë‹¤.

ìˆœì „íˆ íŠ¸ë¼ì´ ì•¤ ì—ëŸ¬ë¡œ ì°¾ì•„ë‚¸ ê²°ê³¼ë¬¼ì¸ë°ìš”.

ì§€ë‚œ 2í¸ì˜ í’€ìŠ¤íƒ ê°•ì˜ì—ì„œëŠ” Cloudflare Pagesì—ì„œ functions í´ë” ë°‘ì— ìˆëŠ” js íŒŒì¼ì€ workersê°€ ëœë‹¤ê³  í–ˆì—ˆëŠ”ë°ìš”.

ê±°ê¸°ì„œëŠ” context.env.DBë¼ê³  í•´ì„œ 'DB'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë°”ì¸ë”©ëœ D1 ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

AstroJSì—ì„œë„ ê°€ëŠ¥í•œë°ìš”.

ì˜ˆì „ AstroJS ë²„ì „ì—ì„œëŠ” "@astrojs/cloudflare/runtime" íŒ¨í‚¤ì§€ì—ì„œ getRuntime í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ env.DB ë¶€ë¶„ì— ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”.

AstroJSê°€ ë²„ì „ì—… ë˜ë©´ì„œ ì´ ë°©ì‹ì€ ì—†ì–´ì§€ê³  ë‹¨ìˆœíˆ Astro.locals.runtime ê°ì²´ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë°, Astro.locals.runtime ê°ì²´ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œ ì„¸íŒ…í•´ì•¼ í•  ë¶€ë¶„ì´ ë§ì€ë°ìš”.

ë¨¼ì €, env.d.ts íŒŒì¼ì— Env íƒ€ì…ì„ ì§€ì •í•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```js
/// <reference types="astro/client" />

// type KVNamespace = import("@cloudflare/workers-types").KVNamespace;
type D1Database = import("@cloudflare/workers-types").D1Database;
type ENV = {
  // replace `MY_KV` with your KV namespace
  DB: D1Database;
};

// Depending on your adapter mode
// use `AdvancedRuntime<ENV>` for advance runtime mode
// use `DirectoryRuntime<ENV>` for directory runtime mode
type Runtime = import("@astrojs/cloudflare").DirectoryRuntime<ENV>;
declare namespace App {
  interface Locals extends Runtime {}
}
```

KVNamespaceë¥¼ ì§€ì •í•˜ëŠ” ë°©ì‹ì´ ê³µì‹ ë¬¸ì„œì— ìˆì—ˆëŠ”ë°ìš”.

ì €ëŠ” ê±°ê¸°ì„œ D1Databaseë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.

ìš°ë¦¬ê°€ wrangler.toml íŒŒì¼ì—ì„œ ë°”ì¸ë”©ì„ 'DB'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í–ˆê¸° ë•Œë¬¸ì— ìœ„ì—ì„œ DBë¼ê³  ì¼ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  Runtime ë¶€ë¶„ì¸ë°ìš”.

AstroJSë¥¼ server ë°©ì‹ìœ¼ë¡œ ìš´ì˜í•˜ë©´ ê¸°ë³¸ ëª¨ë“œê°€ ë°”ë¡œ advanced ëª¨ë“œê°€ ë©ë‹ˆë‹¤.

ì´ ëª¨ë“œëŠ” astro.config.mjs íŒŒì¼ì—ì„œ ì§€ì •í•˜ëŠ”ë°ìš”.

"advanced" ëª¨ë“œì™€ "directory" ëª¨ë“œì— ëŒ€í•´ ê°„ë‹¨íˆ ì„¤ëª…í•˜ë©´,

"advanced" ëª¨ë“œëŠ” Workers ë°©ì‹ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ AstroJSê°€ ë¹Œë“œë˜ë©´ dist í´ë”ì— \_worker.js íŒŒì¼ì´ ìƒê¸°ëŠ”ë°ìš”.

ì´ íŒŒì¼ì´ ë°”ë¡œ ì„œë²„ íŒŒì¼ì¸ê±°ì£ .

"directory" ëª¨ë“œëŠ” Pages ë°©ì‹ì…ë‹ˆë‹¤.

ì •í™•íˆ ì–˜ê¸°í•˜ë©´ Pagesì˜ Functions ë°©ì‹ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì´ ë°©ì‹ìœ¼ë¡œ AstroJSë¥¼ ë¹Œë“œí•˜ë©´ í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— functions í´ë”ê°€ ìƒê¸°ê³  ê·¸ ë°‘ì— '[[path]].js' íŒŒì¼ì´ ìƒê¹ë‹ˆë‹¤.

ê·¸ë˜ì„œ 'wrangler pages deploy'í•˜ê²Œ ë˜ë©´ wranglerê°€ ìì—°ìŠ¤ëŸ½ê²Œ Pages Functionsìœ¼ë¡œ ì¸ì‹í•´ì„œ ì—£ì§€ ì„œë²„ì— ì˜¬ë ¤ì¤ë‹ˆë‹¤.

pagesì— ë°°í¬í•˜ê¸° ë•Œë¬¸ì— "directory" ëª¨ë“œë¡œ í•˜ê² ìŠµë‹ˆë‹¤.

'env.d.ts' íŒŒì¼ ì„¤ì •ì´ ëë‚¬ìœ¼ë©´ ì´ì œ 'astro.config.mjs' íŒŒì¼ì„ ê³ ì³ë³´ê² ìŠµë‹ˆë‹¤.

```js
import { defineConfig } from 'astro/config'

import cloudflare from '@astrojs/cloudflare'
import tailwind from '@astrojs/tailwind'

// https://astro.build/config
export default defineConfig({
  output: 'server',
  adapter: cloudflare({
    mode: 'directory',
    runtime: {
      mode: 'local',
      type: 'pages',
      bindings: {
        "DB": {
          type: 'd1',
        },
      },
    },
  }),
  integrations: [tailwind()],
})
```

ìœ„ì™€ ê°™ì´ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.

adapter ë¶€ë¶„ì— cloudflareì•ˆì— ê°ì²´ë¥¼ ë„£ì–´ì„œ ì„¤ì •í•˜ëŠ” ê±´ë°ìš”.

mode ë¶€ë¶„ì€ ë””í´íŠ¸ ê°’ìœ¼ë¡œ 'advanced'ì´ê¸° ë•Œë¬¸ì— ìƒëµí•´ë„ ë©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì¤‘ìš”í•œê²Œ runtime ë¶€ë¶„ì¸ë°ìš”.

Astro.locals.runtime ê°ì²´ê°€ ì œëŒ€ë¡œ ì¸ì‹ë˜ê¸° ìœ„í•´ì„œ ë„£ì€ ê²ë‹ˆë‹¤.

modeê°€ 'advanced'ê°’ì´ë©´ ì•„ê¹Œ Worker íƒ€ì…ì´ë¼ê³  í–ˆì£ .

ê·¸ë˜ì„œ typeì„ 'workers'ë¡œ í•´ì•¼ í•˜ê³ , ë§Œì•½ modeê°€ 'directory' ëª¨ë“œ ì´ë©´ typeëŠ” 'pages'ë¡œ í•˜ë©´ ë©ë‹ˆë‹¤.

ê·¸ë‹¤ìŒ ì¤‘ìš”í•œ D1 DB ë°”ì¸ë”©ì´ ìˆëŠ”ë°ìš”.

binding ë¶€ë¶„ì— 'DB'ë¼ëŠ” ë¬¸ìì—´ì´ ìˆëŠ”ë°ìš”.

ì´ê±´ ìš°ë¦¬ê°€ wrangler.toml íŒŒì¼ì— ì„¤ì •í–ˆë˜ ê·¸ ë°”ì¸ë”© ì´ë¦„ "DB"ì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  íƒ€ì…ì€ ì†Œë¬¸ìë¡œ 'd1'ì´ë¼ê³  D1 DBë¼ëŠ” ê±¸ ëª…ì‹œí–ˆì£ .

ì´ì œ, Astro.locals.runtime ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì¤€ë¹„ê°€ ë‹¤ ëë‚¬ëŠ”ë°ìš”.

src í´ë”ì˜ pages í´ë” ë°‘ì— ìˆëŠ” index.astro í˜ì´ì§€ë¥¼ ì•„ë˜ì™€ ê°™ì´ ê³ ì³ì„œ í…ŒìŠ¤íŠ¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
---
import { drizzle } from 'drizzle-orm/d1';
import { todos } from '../db/schema';

const runtime = Astro.locals.runtime;

const db = drizzle(runtime.env.DB);

const result = await db.select().from(todos).all();
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body>
		<h1>Astro</h1>
		<ul>
			{result ? result.map((r) => <li>{r.name}</li>):<></>}
		</ul>

	</body>
</html>
```

ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¤€ë¹„ê°€ ë‹¤ ëë‚¬ëŠ”ë°ìš”.

ì—¬ê¸°ì„œ ë‹¨ìˆœí•˜ê²Œ 'npm run dev' ëª…ë ¹ì–´ë¡œ ê°œë°œ ì„œë²„ë¥¼ ëŒë¦¬ë©´ ì•ˆ ë©ë‹ˆë‹¤.

'.wrangler' í´ë” ë°‘ì— ê°œë°œ DBê°€ ìˆ¨ì–´ ìˆê¸° ë•Œë¬¸ì— wrangler dev ë°©ì‹ìœ¼ë¡œ ê°œë°œ ì„œë²„ë¥¼ ëŒë ¤ì•¼ í•©ë‹ˆë‹¤.

ë§Œì•½ modeê°€ 'advanced'ì˜ Workers ë°©ì‹ì´ë©´ ì•„ë˜ì™€ ê°™ì´ ê°œë°œ ì„œë²„ë¥¼ ëŒë¦¬ë©´ ë©ë‹ˆë‹¤.

```bash
npx wrangler dev

 â›…ï¸ wrangler 3.19.0
-------------------
Your worker has access to the following bindings:
- D1 Databases:
  - DB: astro-db (---------------------)
â” Starting local server...
[wrangler:inf] Ready on http://localhost:8787
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ [b] open a browser, [d] open Devtools, [l] turn off local mode, [c] clear console, [x] to exit                 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

ìœ„ì™€ ê°™ì´ ë‚˜ì˜¤ë©´ 'b'ë¥¼ ëˆŒëŸ¬ ë¸Œë¼ìš°ì €ë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ ë©ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEjmmOd7VP28xFkEhnwS32_JxLhfkpRuYvLqxB3A-XTnhhxRQcbnI0qQqG1dbmboz1OxT1k5NLdtT_xr-f5CKqulGsgNLF81jJsTReLPKHqRWqd9lM2ukjff3RfzEMeGatEBtsSiO_rDesEFcvzwe75KXoAQ2A8hX1C_ePGpH_9_SvDaSh2eBlJToED3e7o)

ìœ„ì™€ ê°™ì´ ìš°ë¦¬ê°€ ì‘ì„±í•œ ì½”ë“œê°€ ì œëŒ€ë¡œ ë‚˜ì˜¤ë„¤ìš”.

ê·¸ë¦¬ê³  ë‹¤ìŒê³¼ ê°™ì´ wrangler pages dev ë°©ì‹ì„ ì¨ë„ ë©ë‹ˆë‹¤.

ì‚¬ì‹¤ Cloudflareê°€ ì•ìœ¼ë¡œ Pages ì•ˆì— Functionsì„ Workers ì‚¬ìš© ë°©ì‹ìœ¼ë¡œ ê¶Œì¥í•˜ê±°ë“ ìš”.

ê·¸ë˜ì„œ wrangler dev ë°©ì‹ì´ë‚˜ wrangler pages dev ë°©ì‹ì´ë‚˜ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤.

ì•ìœ¼ë¡œëŠ” wrangler pages dev ë°©ì‹ì„ ì´ìš©í•˜ê² ìŠµë‹ˆë‹¤.

ê¼­ ë¹Œë“œí•˜ê³  ì‹¤í–‰ í•˜ì‹­ì‹œìš”.

```bash
npm run build

npx wrangler pages dev ./dist
```

---

## 7. End Pointë¡œ POST ë©”ì„œë“œ ëŒ€ì‘í•˜ê¸°

D1 DBì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê±°ëŠ” ë‹¨ìˆœíˆ db.select() ë©”ì„œë“œë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë°, ìš°ë¦¬ê°€ ì—¬ê¸°ì„œ formì„ ì´ìš©í•´ì„œ todosë¥¼ ì¶”ê°€í•˜ë ¤ê³  í•œë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?

ë°”ë¡œ API End Pointê°€ í•„ìš”í•©ë‹ˆë‹¤.

AstroJSì—ì„œëŠ” í™•ì¥ìê°€ .ts ë˜ëŠ” .jsë¡œ ëë‚˜ë©´ API End Pointê°€ ë©ë‹ˆë‹¤.

ë‹¹ì—°íˆ src/pages í´ë” ë°‘ì— ìˆì–´ì•¼ê² ì£ .

ì¼ë‹¨, index.astro í˜ì´ì§€ì— form íƒœê·¸ë¥¼ ì¶”ê°€í•´ì„œ UI ë¶€ë¶„ì„ ì™„ì„±í•˜ê³  ë‚˜ì„œ APIë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

UI ë¥¼ ë§Œë“œëŠ” ê¹€ì— delete ë²„íŠ¼ê¹Œì§€ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

```js
---
import { drizzle } from "drizzle-orm/d1";
import { todos } from "../db/schema";

const runtime = Astro.locals.runtime;

const db = drizzle(runtime.env.DB);
const result = await db.select().from(todos).all();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
  </head>
  <body>
    <h1>Astro!!!</h1>
    <form method="post" action="/api/post-todos">
      <input type="text" name="name" />
      <input type="checkbox" name="isCompleted" />
      <button type="submit"> Add Todo</button>
    </form>
    <ul>
      {result ? result.map((r) => <li>{r.name}
        <form method="post" action="/api/delete-todos">
          <input type="hidden" name="todoId" value={r.id} />
          <button type="submit">Delete</button>  
        </form>
        </li>):<></>}

    </ul>
  </body>
</html>
<style>
  body {
    @apply p-8 space-y-5
  }
  form {
    @apply flex justify-start space-x-5
  }

  li {
    @apply flex justify-start gap-5
  }
   button {
    @apply border bg-blue-500 rounded-lg px-2 py-1
   }
</style>
```

form íƒœê·¸ê°€ ë‘ ê°œê°€ ìˆëŠ”ë°ìš”.

í•˜ë‚˜ëŠ” 'api/post-todos' ì—”ë“œ í¬ì¸íŠ¸ë¥¼ ì´ìš©í•˜ëŠ” ê±°ê³ ,

delete ë²„íŠ¼ì€ 'api/delete-todos'ë¥¼ ì´ìš©í•˜ëŠ” ê²ë‹ˆë‹¤.

ì´ì œ API ì—”ë“œ í¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
// src/pages/api/post-todos.ts

import type { APIContext } from "astro";
import { drizzle } from "drizzle-orm/d1";
import { todos } from "../../db/schema";

export async function POST(context: APIContext) {
  const formData = await context.request.formData();
  const name = formData.get("name") as string;
  const isCompletedData = formData.get("isCompleted");

  const isCompleted = isCompletedData ? true : false;

  const runtime = context.locals.runtime;

  const db = drizzle(runtime.env.DB);
  const result = await db.insert(todos).values({ name, isCompleted }).run();
  console.log("insert result", result);

  return context.redirect("/", 302);
}
```

formDataì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ Drizzle ORMì„ ì´ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— insert í•˜ëŠ” ê²ë‹ˆë‹¤.

ì´ì œ delete-todos.ts íŒŒì¼ì…ë‹ˆë‹¤.

```js
//src/pages/delete-todos.ts

import type { APIContext } from "astro";
import { drizzle } from "drizzle-orm/d1";
import { todos } from "../../db/schema";
import { eq } from "drizzle-orm";

export async function POST(context: APIContext) {
  const formData = await context.request.formData();
  const todoIdData = formData.get("todoId") as string;

  const todoId = todoIdData ? parseInt(todoIdData) : -1;
  const runtime = context.locals.runtime;

  const db = drizzle(runtime.env.DB);
  const result = await db.delete(todos).where(eq(todos.id, todoId)).returning();

  console.log("deleting:", result);

  return context.redirect("/", 302);
}
```

ì—­ì‹œ ë³„ë¡œ ì–´ë ¤ìš¸ ê±° ì—†ëŠ” Drizzle ORMì„ ì´ìš©í•œ ì½”ë“œì…ë‹ˆë‹¤.

Delete ë©”ì„œë“œë„ POST ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ê±¸ ëˆˆì—¬ê²¨ë³´ì‹­ì‹œì˜¤.

ë³´í†µ ë¸Œë¼ìš°ì €ëŠ” GET, POST ë‘ ê°œì˜ ë©”ì„œë“œë¡œ ë³€í™˜í•´ì„œ ì‚¬ìš©í•˜ë‹ˆê¹Œ ì—¬ê¸°ì„œëŠ” POST ë©”ì„œë“œë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

ì´ì œ, ëª¨ë“  API ì—”ë“œ í¬ì¸íŠ¸ê°€ ëë‚¬ìŠµë‹ˆë‹¤.

ë¹Œë“œ í›„ì— npx wrangler pages devë¡œ í…ŒìŠ¤íŠ¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```bash
npm run build

npx wrangler pages dev ./dist
```

wrangler ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë³´ì…ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEhyZkfoheokYd1bw3ZbXhYlmhSORTWawddRYPKuxTEX3PQt9hdsoOYkHISDAn4cLMbTkQZ0LJB1KG1bmcdxQhJlUqkxuvSHuMYH0WtcoiJfuOMtBWmLHPi5W6bLleyzQCBoF4FYLISeZoxQwyIVa-ioqkMl75Z7DJb8mli6YhYVUBx7cvQ9RGS4IzmFAS4)

Delete ë²„íŠ¼í•˜ê³  Add ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ë©´ ì •ìƒ ì‘ë™í•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

---

## 8. EDGE ì„œë²„ì— ì˜¬ë¦¬ê¸°

ì´ì œ ë¡œì»¬ì—ì„œì˜ ê°œë°œì€ ëë‚¬ìŠµë‹ˆë‹¤.

ì´ê±¸ Cloudflare EDGE ì„œë²„ì— ì˜¬ë ¤ì•¼ í•˜ëŠ”ë°ìš”.

ë”ë¯¸ ë°ì´í„°ëŠ” í•„ìš” ì—†ê³ , todos í…Œì´ë¸”ë§Œ ì˜¬ë¦¬ë©´ ë©ë‹ˆë‹¤.

```bash
npx wrangler d1 execute astro-db --file=./drizzle/0000_stormy_scarlet_witch.sql

ğŸŒ€ Mapping SQL input into an array of statements
ğŸŒ€ Parsing 1 statements
ğŸŒ€ Executing on remote database astro-db (77asdfasdfsadfsadfasd=asdfsadf4260):
ğŸŒ€ To execute on your local development database, pass the --local flag to 'wrangler d1 execute'
ğŸš£ Executed 1 commands in 0.365ms
```

ìœ„ì™€ ê°™ì´ '--local' ì˜µì…˜ì„ ë¹¼ê³  ì‹¤í–‰í•´ì„œ ì•„ë˜ì™€ ê°™ì´ Cloudflare Edge ì„œë²„ì— todos ë¼ëŠ” í…Œì´ë¸”ì´ ë³´ì´ê²Œ ë ê²ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEggvqvo6tDXCZyXJolGPHOf0X6E16564l8TinG4LjzO1QjYeKQ2qynRMzAL65KZpWFwQoD9Tc1Qsv-eY0t03Wd68_SQudBflVt7CdW7mD-ZiATkiiXEgoZS2WWowIsQ_BL6x-iku0HcQ5WnSumwctx1-Y8i-tw0b_GzFZg70NyGeBCjdVWH_9Cp26jRnM8)

ì´ì œ ì‹¤ì œ ë°°í¬ë¥¼ í•´ì•¼ ë˜ëŠ”ë°ìš”.

ë‹¤ì‹œ í•œë²ˆ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

```bash
npm run build

npx wrangler pages deploy dist

No project selected. Would you like to create one or use an existing project?
â¯ Create a new project
  Use an existing project

? Enter the name of your new project: â€º astro-pages-d1-example
```
ì²˜ìŒ ë°°í¬í•˜ëŠ” ê±°ë©´ ìœ„ì™€ ê°™ì´ "Create a new project"ë¥¼ ê³ ë¥´ë©´ ë©ë‹ˆë‹¤.

í”„ë¡œì íŠ¸ ì´ë¦„ì€ ì ë‹¹í•œ ê±¸ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.

ê·¸ëŸ°ë°, ë§Œì•½ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤ë©´ ì•„ë§ˆë„ git commitì„ ì•ˆ í•´ì„œ ê·¸ëŸ° ê²ë‹ˆë‹¤.

```bash
fatal: ambiguous argument 'HEAD': unknown revision or path not in the working tree.
Use '--' to separate paths from revisions, like this:
'git <command> [<revision>...] -- [<file>...]'

âœ˜ [ERROR] Command failed: git rev-parse --abbrev-ref HEAD

  fatal: ambiguous argument 'HEAD': unknown revision or path not in the working tree.
  Use '--' to separate paths from revisions, like this:
  'git <command> [<revision>...] -- [<file>...]'
  


If you think this is a bug then please create an issue at https://github.com/cloudflare/workers-sdk/issues/new/choose
```

ì•„ë˜ì™€ ê°™ì´ git commit í•´ì£¼ê³  ë‹¤ì‹œ ë°°í¬í•©ë‹ˆë‹¤.

```bash
git add .
git commit -m "initial commit"
npx wrangler pages deploy dist

No project selected. Would you like to create one or use an existing project?
â¯ Create a new project
  Use an existing project
âœ” Enter the name of your new project: â€¦ astro-pages-d1-example
? Enter the production branch name: â€º main
```

ìµœì¢…ì ìœ¼ë¡œ branch nameì„ ë¬¼ì–´ë´…ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì—”í„°í‚¤ë¥¼ ëˆ„ë¥´ë©´ ë©ë‹ˆë‹¤.

ì´ì œ ê²°ê³¼ë¥¼ ë³´ë©´

```bash
âœ¨ Successfully created the 'astro-pages-d1-example' project.
âœ¨ Compiled Worker successfully
ğŸŒ  Uploading... (2/2)

âœ¨ Success! Uploaded 2 files (2.42 sec)

âœ¨ Uploading Functions bundle
âœ¨ Uploading _routes.json
âœ¨ Deployment complete! Take a peek over at https://aae38d5a.astro-pages-d1-example.pages.dev
```

ìœ„ì™€ ê°™ì´ ì„±ê³µí–ˆë‹¤ê³  ë‚˜ì˜¤ëŠ”ë°ìš”.

ìœ„ì—ì„œ ë³´ì—¬ì£¼ëŠ” ì„±ê³µí•œ ì£¼ì†Œ ê²½ë¡œë¡œ ì´ë™í•´ ë³¼ê¹Œìš”?

ê·¸ëŸ¬ë©´ ì‹¤ì œ Cloudflare Edge ì„œë²„ì— ë°°í¬ê°€ ë©ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEhxT6fDec0TXk8Tlne-tRYrHngjwpHxI588X83pS_NDRDaQYDb5ZV3VsNVKhTHgOs5qHlrFyy1M5cHJgBtjUkY0y3Pe2uYQp9UFvDv_23QE9iwrS6JcjufWleDo8QHJgsupeJpHpk2NCzhYixUOoRLrz0XxBueXlVWEcZi5mIuefJgiwFQq-QIrrcz2bn4)

ìœ„ì™€ ê°™ì´ ì—ëŸ¬ê°€ ë‚˜ì˜µë‹ˆë‹¤.

ì´ê²Œ ì™œ ê·¸ë ‡ë‚˜ë©´ ë°”ë¡œ Cloudflare Edge ì„œë²„ì—ì„œ D1 ë°”ì¸ë”©ì´ ì²˜ë¦¬ë˜ì§€ ì•Šì•„ì„œ ê·¸ëŸ° ê²ë‹ˆë‹¤.

Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ "Workers & Pages" ë©”ë‰´ë¡œ ê°€ë©´ ì•„ë˜ì™€ ê°™ì´ ì•„ê¹Œ ë§Œë“  astro-pages-d1-example í”„ë¡œì íŠ¸ê°€ ë³´ì¼ ê²ë‹ˆë‹¤.

ìš°ë¦¬ê°€ ì•„ê¹Œ í„°ë¯¸ë„ ìƒì—ì„œ deployë¥¼ ì²˜ìŒ í–ˆê¸° ë•Œë¬¸ì— ì´ì œì•¼ ìƒê¸´ ê²ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEj59FEPIPWjMtUg1rW9_65LC9iJjycG5f0-e2edZ_YACJBMWd6OnMu4jC32PkFDW5UsI_TAZ1uU6VGB8HEt0DwLxmVKH3lA9HnqmT5EERMY8TCoWIQOE-05foA7XP3cllVgRKcojjP8EOSYlER5obMg41mF13jegV56_2nmjgXgpCMqdriuTBxBIu6gBFc)

ì—¬ê¸°ì„œ 'astro-pages-d1-example' í”„ë¡œì íŠ¸ë¥¼ ëˆ„ë¥´ë©´ ë‹¤ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ë“¤ì–´ê°€ëŠ”ë°, Settings í•­ëª©ìœ¼ë¡œ ë“¤ì–´ê°„ ë‹¤ìŒ ì„¸ ë²ˆì§¸ 'Functions' í•­ëª©ì„ ëˆ„ë¥´ë©´ ë°‘ì— ì—¬ëŸ¬ ê°œê°€ ë‚˜ì˜¤ëŠ”ë° ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ 'D1 database bindings' í•­ëª©ì„ í´ë¦­í•˜ë©´ ë©ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEjrSU3E1G8BssLp9GHX4RA6qEGy-VYacE0i7a6hJ0cyE-yLaCXUwwnzb57DPgDeUz6-0kr-HLAtU2NBZBnt_C2iPtGEVmeBfmlpuHBHtZjJUl45RrwuZqX_8jhb566RFYnnWkxKNBs6_ZVsmK5XCelpRkrKatLaz_8vWlZKi_vQ_dz2sHHmk9rszbOv_RI)

ìœ„ì™€ ê°™ì´ ìš°ë¦¬ê°€ ì½”ë“œì—ì„œ ë°”ì¸ë”© ì´ë¦„ìœ¼ë¡œ ì¼ë˜ 'DB'ë¼ëŠ” ê¸€ìì™€ í•¨ê»˜ í•´ë‹¹ D1 DBë¥¼ ì—°ê²°í•˜ê²Œ í•´ì£¼ê³  'Save' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ë©´ ë©ë‹ˆë‹¤.

ì´ì œ ë‹¤ì‹œ 'https://astro-pages-d1-example.pages.dev' ì£¼ì†Œë¡œ ê°€ë³¼ê¹Œìš”?

ê·¸ëŸ°ë° ì—­ì‹œë‚˜ ì—ëŸ¬ê°€ ë‚©ë‹ˆë‹¤.

ì™œ ê·¸ëŸ°ê°€ í•˜ë©´ ì¼ë‹¨ Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ ì„¤ì •ì„ ë°”ê¿¨ìœ¼ë©´ ë°˜ë“œì‹œ í„°ë¯¸ë„ ìƒì—ì„œ ë‹¤ì‹œ ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤.

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í•œ ë²ˆë§Œ ë” ì‹¤í–‰ì‹œì¼œ ì£¼ë©´ ë©ë‹ˆë‹¤.

```bash
npx wrangler pages deploy dist
```

ë‹¤ì‹œ í•´ë‹¹ ì£¼ì†Œë¡œ ê°€ë©´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ì˜ ì‘ë™í•˜ëŠ” ëª¨ìŠµì´ ë³´ì¼ ê²ë‹ˆë‹¤.

![](https://blogger.googleusercontent.com/img/a/AVvXsEgQAfdyJTgFAfyIGrCpBAr9YDpqOKaee4YXeYxnY9TefO18WV54LlVdt63l1Tp36_0pYDrP-4myotjxvdWNL-wDBcwYQ5-X0OJRFY8haa991O-LPmWjbXTMJvFjRkukqdHsgt5H1EHhNAu1FGSE-NdRVYWjGxoLsY0CyDUPmQhJ9_8fTnkS-w8mqZH80TQ)

ì–´ë–¤ê°€ìš”?

AstroJSì™€ Cloudflare Pages + D1 + Drizzle ORM ê¹Œì§€ ì™„ë²½í•˜ê²Œ êµ¬í˜„í–ˆë„¤ìš”.

ê·¸ëŸ°ë° ì¡°ê¸ˆ ì•„ì‰¬ìš´ ì ì€ UI ê°œë°œ ì„œë²„ì™€ Wrangler ê°œë°œ ì„œë²„ê°€ proxyë¡œ ì—°ê²°ë˜ì§€ ì•ŠëŠ” ì ì´ ë¬¸ì œì…ë‹ˆë‹¤.

ì›ë˜ëŠ” ì•„ë˜ì²˜ëŸ¼ í•˜ë©´ proxyë¡œ ê°œë°œ ì„œë²„ì™€ Wrangler ê°œë°œ ì„œë²„ê°€ ì—°ë™ë˜ëŠ”ë° í˜„ì¬ Wranglerê°€ ë¶ˆì•ˆí•œì§€ ì•„ë‹ˆë©´ AstroJSì˜ ë²„ê·¸ì¸ì§€ ì œëŒ€ë¡œ ì—°ë™ë˜ì§€ ì•Šì•˜ëŠ”ë°ìš”.

```json
"pages:dev": "wrangler pages dev --compatibility-date=2023-12-09 --proxy 3000 -- astro dev",
"pages:deploy": "astro build && wrangler pages deploy ./dist"
```

í˜¹ì‹œ ê³ ì¹˜ì‹¤ ìˆ˜ ìˆëŠ” ë¶„ ëŒ“ê¸€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê·¸ëŸ¼.
