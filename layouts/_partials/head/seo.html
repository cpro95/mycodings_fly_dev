{{- $title := .Title -}}
{{- $description := .Summary | plainify | truncate 155 -}}
{{- $canonical := .Permalink -}}
{{- $image := "" -}}
{{- $datePublished := .Date.Format "2006-01-02T15:04:05Z07:00" -}}
{{- $dateModified := .Lastmod.Format "2006-01-02T15:04:05Z07:00" -}}

{{- with .Params.seo -}}
  {{- $title = .title | default $title -}}
  {{- $description = .description | default $description -}}
  {{- $canonical = .canonical | default $canonical -}}
{{- end -}}

{{- $images := .Resources.ByType "image" -}}
{{- $featured := $images.GetMatch "*feature*" -}}
{{- if not $featured }}{{ $featured = $images.GetMatch "{*cover*,*thumbnail*}" }}{{ end -}}
{{- if $featured -}}
  {{- $image = $featured.Permalink -}}
{{- else if site.Params.images -}}
  {{- $image = index site.Params.images 0 | absURL -}}
{{- end -}}

<title>{{ $title }}</title>
<meta name="description" content="{{ $description }}" />
<link rel="canonical" href="{{ $canonical }}" />

{{- if or .Params.draft (and .Params.seo .Params.seo.noindex) }}
<meta name="robots" content="noindex, nofollow" />
{{- else }}
<meta name="robots" content="index, follow" />
{{- end }}

<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
<meta property="og:title" content="{{ $title }}" />
<meta property="og:description" content="{{ $description }}" />
<meta property="og:url" content="{{ $canonical }}" />
<meta property="og:site_name" content="{{ site.Title }}" />
{{- with $image }}
<meta property="og:image" content="{{ . }}" />
{{- end }}
<meta property="og:locale" content="{{ site.Language.Lang | default "ko_KR" }}" />
{{- if .IsPage }}
<meta property="article:published_time" content="{{ $datePublished }}" />
<meta property="article:modified_time" content="{{ $dateModified }}" />
{{- with .Params.tags }}{{ range first 6 . }}
<meta property="article:tag" content="{{ . }}" />
{{- end }}{{ end }}
{{- end }}

<meta name="twitter:card" content="summary{{ if $image }}_large_image{{ end }}" />
<meta name="twitter:title" content="{{ $title }}" />
<meta name="twitter:description" content="{{ $description }}" />
{{- with $image }}
<meta name="twitter:image" content="{{ . }}" />
{{- end }}

<meta name="author" content="{{ .Params.author | default site.Params.author | default site.Title }}" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ if .IsPage }}BlogPosting{{ else }}WebSite{{ end }}",
  "headline": {{ $title | jsonify }},
  "description": {{ $description | jsonify }},
  {{- if .IsPage }}
  "datePublished": {{ $datePublished | jsonify }},
  "dateModified": {{ $dateModified | jsonify }},
  "author": {
    "@type": "Person",
    "name": {{ (.Params.author | default site.Params.author | default site.Title) | jsonify }}
  },
  {{- end }}
  {{- with $image }}
  "image": {{ . | jsonify }},
  {{- end }}
  "url": {{ $canonical | jsonify }},
  "publisher": {
    "@type": "Organization",
    "name": {{ site.Title | jsonify }}
    {{- with site.Params.logo }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ . | absURL | jsonify }}
    }
    {{- end }}
  }
}
</script>
